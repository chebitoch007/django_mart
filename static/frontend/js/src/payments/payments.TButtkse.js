class R{memoryStore=new Map;useSessionStorage=!1;constructor(){try{const e="__storage_test__";sessionStorage.setItem(e,"test"),sessionStorage.removeItem(e),this.useSessionStorage=!0}catch{console.warn("[Storage] sessionStorage not available, using in-memory fallback"),this.useSessionStorage=!1}}setItem(e,t){try{this.useSessionStorage?sessionStorage.setItem(e,t):this.memoryStore.set(e,t)}catch(s){console.error("[Storage] Failed to set item:",s),this.memoryStore.set(e,t)}}getItem(e){try{return this.useSessionStorage?sessionStorage.getItem(e):this.memoryStore.get(e)||null}catch(t){return console.error("[Storage] Failed to get item:",t),this.memoryStore.get(e)||null}}removeItem(e){try{this.useSessionStorage&&sessionStorage.removeItem(e),this.memoryStore.delete(e)}catch(t){console.error("[Storage] Failed to remove item:",t),this.memoryStore.delete(e)}}clear(){try{this.useSessionStorage&&sessionStorage.clear(),this.memoryStore.clear()}catch(e){console.error("[Storage] Failed to clear storage:",e),this.memoryStore.clear()}}}const f=new R;function T(n){if(!n)return!1;const e=n.trim().replace(/\s+/g,""),t=/^(?:254|\+254|0)?(7[0-9]{8})$/,s=e.match(t);return s?`254${s[1]}`:!1}function I(n,e){const t=e==="UGX"||e==="TZS"?0:2;return n.toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t})}function b(n){try{f.setItem("paymentFormState",JSON.stringify(n))}catch(e){console.warn("[Storage] Failed to save form state:",e)}}function D(){try{const n=f.getItem("paymentFormState");return n?JSON.parse(n):{}}catch(n){return console.warn("[Storage] Failed to restore form state:",n),{}}}async function z(n,e={},t=3e4){const s=new AbortController,i=setTimeout(()=>s.abort(),t);try{const r=await fetch(n,{...e,signal:s.signal});return clearTimeout(i),r}catch(r){throw clearTimeout(i),r.name==="AbortError"?new Error("Request timed out. Please check your connection."):r}}function N(n){return{mpesa:"M-Pesa",paypal:"PayPal"}[n]||n}function v(n){return["USD","EUR","GBP","CAD","AUD","JPY"].includes(n)}const w={mpesa:[{title:"Connecting to M-Pesa",text:"Establishing secure connection with Safaricom..."},{title:"Sending Payment Request",text:"Your phone will receive a payment prompt shortly..."},{title:"Awaiting Confirmation",text:"Please check your phone and enter your M-Pesa PIN to complete the payment..."},{title:"Verifying Payment",text:"Confirming your payment with M-Pesa..."},{title:"Finalizing Transaction",text:"Processing payment confirmation and updating your order..."}],paypal:[{title:"Connecting to PayPal",text:"Establishing secure connection..."},{title:"Processing Payment",text:"Completing your PayPal transaction..."},{title:"Finalizing Order",text:"Confirming payment and updating your order..."}]};function x(n,e,t){e.forEach(s=>{s.classList.toggle("active",s.dataset.method===n)}),t.textContent=N(n)}function U(n,e,t){const i={mpesa:{text:"Pay with M-Pesa",icon:"fas fa-mobile-alt"},paypal:{text:"Pay with PayPal",icon:"fab fa-paypal"}}[n];e.textContent=i.text,t.className=i.icon}function k(n,e,t,s){n==="paypal"&&!v(e)?(s.textContent=`Don't worry! PayPal doesn't support ${e}, but we'll automatically convert your payment to USD at the current exchange rate.`,t.style.display="flex"):A(t)}function A(n){n.style.display="none"}function q(n,e,t,s){e.classList.add("active");let i=0;function r(){const l=w[n]||w.mpesa;if(i<l.length){const o=l[i];t.textContent=o.title,s.textContent=o.text,i++,i<l.length&&setTimeout(r,2e3)}}r()}function h(n){n.classList.remove("active")}function O(n,e){const t=e.querySelector("span");t&&(t.textContent=n),e.className="payment-status info",e.style.display="flex"}function p(n,e){const t=e.querySelector("span");t&&(t.textContent=n),e.style.display="flex"}function M(n,e){const t=document.getElementById("paypal-status");if(!t)return;const s=t.querySelector("span");s&&(s.textContent=n),t.className=`payment-status ${e}`,t.style.display="flex"}function B(n){const e=document.getElementById("paypal-status");if(!e)return;const t=e.querySelector("span");t&&(t.textContent=n),e.className="payment-status error",e.style.display="flex"}function _(){const n=document.getElementById("paypal-status");if(!n)return;n.style.display="none";const e=n.querySelector("span");e&&(e.textContent="")}function X(n,e,t){n.classList.add("input-error"),n.classList.remove("input-success");const s=e.querySelector("span");s?s.textContent=t:e.innerHTML=`<i class="fas fa-exclamation-circle"></i> ${t}`,e.classList.add("show")}function L(n,e){n.classList.remove("input-error"),n.classList.add("input-success"),e.classList.remove("show")}function g(n,e){n?(e.classList.add("loading"),e.disabled=!0):(e.classList.remove("loading"),e.disabled=!1)}class S{static instance;paymentInProgress=!1;finalizationInProgress=!1;activePoller=null;currentCheckoutRequestId=null;constructor(){}static getInstance(){return S.instance||(S.instance=new S),S.instance}isPaymentInProgress(){return this.paymentInProgress||this.finalizationInProgress}startPayment(e){this.paymentInProgress=!0,this.currentCheckoutRequestId=e}startFinalization(){return this.finalizationInProgress?(console.warn("[MPESA] Finalization already in progress"),!1):(this.finalizationInProgress=!0,!0)}reset(){this.paymentInProgress=!1,this.finalizationInProgress=!1,this.currentCheckoutRequestId=null,this.activePoller!==null&&(clearInterval(this.activePoller),this.activePoller=null)}setPoller(e){this.activePoller=e}clearPoller(){this.activePoller!==null&&(clearInterval(this.activePoller),this.activePoller=null)}}const d=S.getInstance();async function $(n){if(d.isPaymentInProgress())return console.warn("[MPESA] Payment already in progress"),!1;try{const e=n.getState(),t=n.getElements(),s=n.getConfig(),i=t.phoneInput.value.trim(),r=T(i);if(!r)return p("Please enter a valid phone number",t.paymentErrors),!1;g(!0,t.paymentSubmitButton),q("mpesa",t.processingModal,t.modalTitle,t.modalText);const l={order_id:s.orderId,provider:"MPESA",phone:r,amount:e.currentConvertedAmount,currency:e.currentCurrency},o=await z(s.urls.initiatePayment,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(l)},3e4),a=await o.json();if(!o.ok||!a.success||!a.checkout_request_id)return h(t.processingModal),g(!1,t.paymentSubmitButton),p(a?.error||"Failed to initiate M-Pesa payment",t.paymentErrors),!1;d.startPayment(a.checkout_request_id),n.setState({lastCheckoutRequestId:a.checkout_request_id});const c=document.getElementById("checkoutRequestId");return c&&(c.value=a.checkout_request_id),f.setItem("lastCheckoutRequestId",a.checkout_request_id),t.modalTitle.textContent="Payment Sent to Phone",t.modalText.textContent="Please check your phone and approve the M-Pesa prompt.",j(a.checkout_request_id,n),!0}catch(e){console.error("[MPESA] Error:",e),h(n.getElements().processingModal),g(!1,n.getElements().paymentSubmitButton),d.reset();const t=e instanceof Error?e.message:"Network error. Please try again.";return p(t,n.getElements().paymentErrors),!1}}function j(n,e){const t=e.getElements(),s=e.getConfig();d.clearPoller();const i=3e3,r=40;let l=0;const o=window.setInterval(async()=>{if(l++,l>r){d.clearPoller(),h(t.processingModal),g(!1,t.paymentSubmitButton),d.reset(),p("Payment timed out. Please try again.",t.paymentErrors);return}try{const a=new URL(s.urls.mpesaStatus,window.location.origin);a.searchParams.set("checkout_request_id",n);const c=await fetch(a.toString(),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(!c.ok)throw new Error(`HTTP ${c.status}`);const u=await c.json();u.status==="success"||u.status==="completed"?(d.clearPoller(),t.modalTitle.textContent="Payment Confirmed!",t.modalText.textContent="Finalizing your order...",H(n,e)):(u.status==="failed"||u.status==="cancelled")&&(d.clearPoller(),h(t.processingModal),g(!1,t.paymentSubmitButton),d.reset(),p(u.message||"Payment failed",t.paymentErrors))}catch(a){console.error("[MPESA] polling error",a)}},i);d.setPoller(o)}function H(n,e){if(!d.startFinalization())return;const t=e.getElements(),s=e.getConfig(),i=e.getState(),r=new FormData;r.append("csrfmiddlewaretoken",s.csrfToken),r.append("order_id",s.orderId),r.append("payment_method","mpesa"),r.append("checkout_request_id",n),r.append("phone_number",t.phoneInput.value.trim()),r.append("amount",i.currentConvertedAmount.toString()),r.append("currency",i.currentCurrency),r.append("conversion_rate",i.currentRate.toString()),fetch(s.urls.processPayment,{method:"POST",headers:{"X-CSRFToken":s.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:r}).then(async l=>{const o=await l.json();if(o.success||o.status==="success"||o.message?.includes("already"))f.removeItem("lastCheckoutRequestId"),f.removeItem("paymentFormState"),d.reset(),t.modalTitle.textContent="Payment Successful!",t.modalText.textContent="Redirecting...",setTimeout(()=>{h(t.processingModal),window.location.href=o.redirect_url||s.urls.orderSuccess},1500);else throw new Error(o.message||"Payment verification failed")}).catch(l=>{console.error("[MPESA] finalize error:",l),h(t.processingModal),g(!1,t.paymentSubmitButton),d.reset(),p(l.message||"Error finalizing payment",t.paymentErrors)})}function Y(){d.reset(),console.info("[MPESA] Payment state reset")}let y=null;function F(n){_();const e=n.getState(),t=n.getElements(),s=n.getConfig(),i=document.getElementById("paypal-button-container");if(y){try{y.close()}catch(r){console.warn("Error closing PayPal buttons:",r)}i&&(i.innerHTML="")}if(!e.paypalInitialized)try{if(typeof window.paypal>"u"){console.error("PayPal SDK not loaded");const o=document.getElementById("paypal-fallback");o&&(o.style.display="block");return}let r=e.currentCurrency,l=e.currentConvertedAmount;if(!v(e.currentCurrency)&&e.currentCurrency!=="USD"&&M(`Your ${e.currentCurrency} ${I(e.currentConvertedAmount,e.currentCurrency)} payment will be processed as USD ...`,"info"),y=window.paypal.Buttons({onInit:function(o,a){a.disable();const c=()=>{t.termsCheckbox&&t.termsCheckbox.checked?(console.log("[PayPal] Terms checked, enabling buttons."),a.enable()):(console.log("[PayPal] Terms unchecked, disabling buttons."),a.disable())};t.termsCheckbox?.addEventListener("change",c),c()},onClick:function(o,a){if(!t.termsCheckbox.checked)return B("You must agree to the terms and conditions"),a.reject()},createOrder:function(o,a){const c=n.getState(),u=n.getConfig();let P=c.currentCurrency,m=c.currentConvertedAmount;if(!v(c.currentCurrency)&&c.currentCurrency!=="USD"){P="USD";const E=Array.from(t.currencySelector.options).find(C=>C.value==="USD");if(E){const C=parseFloat(E.dataset.rate||"1");m=parseFloat(u.cartTotalPrice)*C}}return console.log("Creating PayPal order:",{amount:m,currency:P,orderId:u.orderId}),a.order.create({purchase_units:[{amount:{value:m.toFixed(2),currency_code:P},description:`Order #${u.orderId}`,custom_id:u.orderId}]})},onApprove:function(o,a){return n.setState({paypalProcessing:!0}),q("paypal",t.processingModal,t.modalTitle,t.modalText),a.order.capture().then(function(c){const u=document.getElementById("paypalOrderId"),P=document.getElementById("paypalPayerId");u&&(u.value=o.orderID),P&&(P.value=c.payer.payer_id);const m=new FormData;if(m.append("csrfmiddlewaretoken",s.csrfToken),m.append("order_id",s.orderId),m.append("payment_method","paypal"),m.append("paypal_order_id",o.orderID),m.append("paypal_payer_id",c.payer.payer_id),m.append("amount",l.toFixed(2)),m.append("currency",r),!v(e.currentCurrency)&&e.currentCurrency!=="USD"){const E=Array.from(t.currencySelector.options).find(C=>C.value==="USD");m.append("conversion_rate",parseFloat(E?.dataset.rate||"1").toString())}else m.append("conversion_rate","1");V(m,n)}).catch(function(c){console.error("PayPal capture error:",c),h(t.processingModal),p("Failed to complete PayPal payment. Please try again.",t.paymentErrors),n.setState({paypalProcessing:!1})})},onError:function(o){console.error("PayPal error:",o),B("PayPal payment failed. Please try another method."),n.setState({paypalProcessing:!1})},onCancel:function(o){n.setState({paypalProcessing:!1}),M("Payment canceled","info")}}),y&&y.isEligible())y.render("#paypal-button-container").then(()=>{console.log("PayPal buttons rendered successfully"),n.setState({paypalInitialized:!0});const o=document.getElementById("paypal-fallback");o&&(o.style.display="none")}).catch(o=>{console.error("Error rendering PayPal buttons",o);const a=document.getElementById("paypal-fallback");a&&(a.style.display="block")});else{console.log("PayPal buttons not eligible");const o=document.getElementById("paypal-fallback");o&&(o.style.display="block")}}catch(r){console.error("PayPal initialization error:",r);const l=document.getElementById("paypal-fallback");l&&(l.style.display="block")}}function W(){if(y){try{y.close()}catch(e){console.log("Error closing PayPal buttons:",e)}const n=document.getElementById("paypal-button-container");n&&(n.innerHTML=""),y=null}}function V(n,e){const t=e.getElements(),s=e.getConfig();fetch(s.urls.processPayment,{method:"POST",body:n,headers:{"X-CSRFToken":s.csrfToken,"X-Requested-With":"XMLHttpRequest"}}).then(i).catch(r);function i(l){return l.ok?l.json().then(o=>{o.success?(f.removeItem("paymentFormState"),f.removeItem("lastCheckoutRequestId"),t.modalTitle.textContent="Payment Successful!",t.modalText.textContent="Redirecting you to your order confirmation...",e.setState({paypalProcessing:!1}),setTimeout(()=>{h(t.processingModal),window.location.href=o.redirect_url||s.urls.orderSuccess},2e3)):(h(t.processingModal),p(o.error_message||"Payment failed",t.paymentErrors),g(!1,t.paymentSubmitButton),e.setState({paypalProcessing:!1}))}):Promise.reject(l)}function r(l){h(t.processingModal),g(!1,t.paymentSubmitButton),e.setState({paypalProcessing:!1}),l.json?l.json().then(o=>{p(o.error_message||"Unexpected error occurred",t.paymentErrors)}).catch(()=>{p("Network error. Please check your connection.",t.paymentErrors)}):p("Network error. Please check your connection.",t.paymentErrors)}}function G(){try{const n=document.getElementById("paypal-button-container");n&&(n.innerHTML="");const e=document.getElementById("paypal-fallback");e&&(e.style.display="none"),_(),y=null,console.info("[PayPal] Payment state reset successfully.")}catch(n){console.error("[PayPal] Error resetting payment state:",n)}}class J{config;state;elements;formSubmitted=!1;constructor(e){this.config=e,this.state={currentMethod:"mpesa",currentCurrency:e.defaultCurrency,currentRate:1,currentConvertedAmount:parseFloat(e.cartTotalPrice),paypalInitialized:!1,paypalProcessing:!1,processingStage:0},this.elements={},this.init()}init(){this.cacheElements(),this.bindEvents(),this.restoreState(),this.checkExistingPayment(),this.initializePaymentMethod(this.state.currentMethod)}checkExistingPayment(){const e=f.getItem("lastCheckoutRequestId");e&&(console.warn("[PAYMENT] Found existing checkout request ID:",e),O("You have a payment in progress. Please complete it or wait for it to expire.",this.elements.paymentStatus))}cacheElements(){this.elements={formAmount:document.getElementById("formAmount"),paymentForm:document.getElementById("paymentForm"),processingModal:document.getElementById("processingModal"),modalTitle:document.getElementById("modalTitle"),modalText:document.getElementById("modalText"),paymentStatus:document.getElementById("paymentStatus"),paymentErrors:document.getElementById("paymentErrors"),selectedMethodInput:document.getElementById("selectedMethod"),currencySelector:document.getElementById("currencySelector"),currencyTooltip:document.getElementById("currencyTooltip"),tooltipText:document.getElementById("tooltipText"),methodConfirmation:document.getElementById("methodConfirmation"),selectedMethodName:document.getElementById("selectedMethodName"),paymentSubmitButton:document.getElementById("paymentSubmitButton"),submitText:document.getElementById("submitText"),submitIcon:document.getElementById("submitIcon"),formCurrency:document.getElementById("formCurrency"),formConversionRate:document.getElementById("formConversionRate"),mobileMoneySection:document.getElementById("mobileMoneySection"),paypalSection:document.getElementById("paypalSection"),paymentTabs:document.querySelectorAll(".payment-tab"),phoneInput:document.getElementById("phoneNumber"),phoneError:document.getElementById("phoneError"),termsCheckbox:document.getElementById("termsAgreement"),summaryToggle:document.getElementById("summaryToggle"),summaryContent:document.getElementById("summaryContent")}}isPaymentInProgress(){return this.formSubmitted||this.state.paypalProcessing}bindEvents(){this.elements.paymentTabs.forEach(e=>{e.addEventListener("click",()=>{e.classList.contains("active")||this.switchPaymentMethod(e.dataset.method)})}),this.elements.currencySelector.addEventListener("change",e=>{this.handleCurrencyChange(e.target)}),this.elements.phoneInput.addEventListener("input",e=>{this.handlePhoneInput(e.target.value)}),this.elements.termsCheckbox.addEventListener("change",()=>{this.handleTermsChange()}),this.elements.paymentForm.addEventListener("submit",e=>{this.handleFormSubmit(e)}),this.elements.summaryToggle.addEventListener("click",()=>{this.toggleSummary()}),window.addEventListener("resize",()=>{this.handleResize()}),window.addEventListener("beforeunload",e=>{if(this.isPaymentInProgress())return e.preventDefault(),e.returnValue="Payment is in progress. Are you sure you want to leave?",e.returnValue}),window.addEventListener("unload",()=>{this.isPaymentInProgress()||f.removeItem("paymentFormState")}),window.addEventListener("popstate",e=>{this.isPaymentInProgress()&&(confirm("Payment is in progress. Are you sure you want to go back?")||window.history.pushState(null,"",window.location.href))})}restoreState(){const e=D();this.state.currentMethod=e.method||"mpesa",this.state.currentCurrency=e.currency||this.config.defaultCurrency,e.phone&&(this.elements.phoneInput.value=e.phone),e.terms&&(this.elements.termsCheckbox.checked=!0)}switchPaymentMethod(e){Y(),G(),this.state.currentMethod=e,this.state.paypalProcessing=!1,this.formSubmitted=!1,x(e,this.elements.paymentTabs,this.elements.selectedMethodName),U(e,this.elements.submitText,this.elements.submitIcon),this.elements.selectedMethodInput.value=e,this.togglePaymentSections(e),e==="paypal"?(k(e,this.state.currentCurrency,this.elements.currencyTooltip,this.elements.tooltipText),console.log("[PAYMENT] Initializing PayPal... (Terms check will happen in onInit)"),setTimeout(()=>F(this),400)):(A(this.elements.currencyTooltip),W()),b({method:e,currency:this.state.currentCurrency,phone:this.elements.phoneInput.value,terms:this.elements.termsCheckbox.checked})}togglePaymentSections(e){e==="paypal"?(this.elements.mobileMoneySection.classList.remove("active"),setTimeout(()=>{this.elements.mobileMoneySection.style.display="none",this.elements.paypalSection.style.display="block",setTimeout(()=>this.elements.paypalSection.classList.add("active"),50)},300)):(this.elements.paypalSection.classList.remove("active"),setTimeout(()=>{this.elements.paypalSection.style.display="none",this.elements.mobileMoneySection.style.display="block",setTimeout(()=>this.elements.mobileMoneySection.classList.add("active"),50)},300))}handleCurrencyChange(e){const t=e.options[e.selectedIndex],s=t.value,i=parseFloat(t.dataset.rate||"1");this.state.currentCurrency=s,this.state.currentRate=i,this.elements.formCurrency.value=s,this.elements.formConversionRate.value=i.toString(),this.updateAmounts(i,s),this.state.currentMethod==="paypal"&&(this.state.paypalInitialized=!1,k("paypal",s,this.elements.currencyTooltip,this.elements.tooltipText),setTimeout(()=>F(this),500)),b({method:this.state.currentMethod,currency:s,phone:this.elements.phoneInput.value,terms:this.elements.termsCheckbox.checked})}updateAmounts(e,t){const s=this.config.currencySymbols[t]||t,i=parseFloat(this.config.cartTotalPrice);this.state.currentConvertedAmount=i*e,document.querySelectorAll(".order-item").forEach(a=>{const c=parseFloat(a.dataset.price||"0"),u=a.querySelector(".item-amount");u&&(u.textContent=I(c*e,t))});const r=document.querySelector(".subtotal-amount"),l=document.querySelector(".total-amount");r&&(r.textContent=I(this.state.currentConvertedAmount,t)),l&&(l.textContent=I(this.state.currentConvertedAmount,t)),this.elements.formAmount.value=this.state.currentConvertedAmount.toFixed(2);const o=document.getElementById("amount");o&&(o.value=`${t} ${I(this.state.currentConvertedAmount,t)}`),document.querySelectorAll(".currency-symbol").forEach(a=>{a.textContent=s})}handlePhoneInput(e){e&&T(e)&&L(this.elements.phoneInput,this.elements.phoneError),b({method:this.state.currentMethod,currency:this.state.currentCurrency,phone:e,terms:this.elements.termsCheckbox.checked})}handleTermsChange(){b({method:this.state.currentMethod,currency:this.state.currentCurrency,phone:this.elements.phoneInput.value,terms:this.elements.termsCheckbox.checked})}async handleFormSubmit(e){if(e.preventDefault(),this.formSubmitted){console.warn("[PAYMENT] Form already submitted, ignoring duplicate submission");return}if(this.elements.paymentErrors.style.display="none",!this.validateForm())return;const t=this.state.currentMethod;if(t==="paypal"){const s=document.getElementById("paypal-button-container");s&&s.scrollIntoView({behavior:"smooth",block:"center"});return}t==="mpesa"&&(this.formSubmitted=!0,await $(this)||(this.formSubmitted=!1))}validateForm(){let e=!0;if(this.state.currentMethod==="mpesa"){const t=this.elements.phoneInput.value.trim();T(t)?L(this.elements.phoneInput,this.elements.phoneError):(X(this.elements.phoneInput,this.elements.phoneError,"Please enter a valid phone number (e.g. 712345678)"),e=!1)}return this.elements.termsCheckbox.checked||(p("You must agree to the terms and conditions",this.elements.paymentErrors),e=!1),e}toggleSummary(){if(this.elements.summaryContent.classList.contains("collapsed")){this.elements.summaryContent.classList.remove("collapsed"),this.elements.summaryToggle.classList.remove("collapsed");const t=this.elements.summaryToggle.querySelector("span");t&&(t.textContent="Hide Details");const s=this.elements.summaryToggle.querySelector("i");s&&(s.style.transform="rotate(180deg)")}else{this.elements.summaryContent.classList.add("collapsed"),this.elements.summaryToggle.classList.add("collapsed");const t=this.elements.summaryToggle.querySelector("span");t&&(t.textContent="Show Details");const s=this.elements.summaryToggle.querySelector("i");s&&(s.style.transform="rotate(0deg)")}}handleResize(){if(window.innerWidth<=991&&!this.elements.summaryContent.classList.contains("collapsed")){if(!this.elements.summaryToggle.classList.contains("initialized")){this.elements.summaryContent.classList.add("collapsed"),this.elements.summaryToggle.classList.add("collapsed");const e=this.elements.summaryToggle.querySelector("span");e&&(e.textContent="Show Details"),this.elements.summaryToggle.classList.add("initialized")}}else window.innerWidth>991&&(this.elements.summaryContent.classList.remove("collapsed"),this.elements.summaryToggle.classList.remove("collapsed"))}initializePaymentMethod(e){if(x(e,this.elements.paymentTabs,this.elements.selectedMethodName),this.switchPaymentMethod(e),window.innerWidth<=991){this.elements.summaryContent.classList.add("collapsed"),this.elements.summaryToggle.classList.add("collapsed");const t=this.elements.summaryToggle.querySelector("span");t&&(t.textContent="Show Details")}}getState(){return{...this.state}}setState(e){this.state={...this.state,...e}}getElements(){return{...this.elements}}getConfig(){return{...this.config}}}document.addEventListener("DOMContentLoaded",function(){if(typeof window.paymentConfig>"u"){console.error("paymentConfig missing. Make sure checkout template injects it.");return}const n=window.paymentConfig,e={cartTotalPrice:n.cartTotalPrice,defaultCurrency:n.defaultCurrency,csrfToken:n.csrfToken,currencySymbols:{USD:"$",EUR:"€",GBP:"£",KES:"KSh",UGX:"USh",TZS:"TSh"},orderId:n.orderId,paypalClientId:n.paypalClientId,urls:n.urls};window.paymentSystem=new J(e)});
