class z{memoryStore=new Map;useSessionStorage=!1;constructor(){try{const e="__storage_test__";sessionStorage.setItem(e,"test"),sessionStorage.removeItem(e),this.useSessionStorage=!0}catch{console.warn("[Storage] sessionStorage not available, using in-memory fallback"),this.useSessionStorage=!1}}setItem(e,t){try{this.useSessionStorage?sessionStorage.setItem(e,t):this.memoryStore.set(e,t)}catch(o){console.error("[Storage] Failed to set item:",o),this.memoryStore.set(e,t)}}getItem(e){try{return this.useSessionStorage?sessionStorage.getItem(e):this.memoryStore.get(e)||null}catch(t){return console.error("[Storage] Failed to get item:",t),this.memoryStore.get(e)||null}}removeItem(e){try{this.useSessionStorage&&sessionStorage.removeItem(e),this.memoryStore.delete(e)}catch(t){console.error("[Storage] Failed to remove item:",t),this.memoryStore.delete(e)}}clear(){try{this.useSessionStorage&&sessionStorage.clear(),this.memoryStore.clear()}catch(e){console.error("[Storage] Failed to clear storage:",e),this.memoryStore.clear()}}}const b=new z;function x(n){if(!n)return!1;const e=n.trim().replace(/\s+/g,""),t=/^(?:254|\+254|0)?(7[0-9]{8})$/,o=e.match(t);return o?`254${o[1]}`:!1}function C(n,e){const t=e==="UGX"||e==="TZS"?0:2;return n.toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t})}function T(n){try{b.setItem("paymentFormState",JSON.stringify(n))}catch(e){console.warn("[Storage] Failed to save form state:",e)}}function U(){try{const n=b.getItem("paymentFormState");return n?JSON.parse(n):{}}catch(n){return console.warn("[Storage] Failed to restore form state:",n),{}}}function N(n){return{mpesa:"M-Pesa",paypal:"PayPal"}[n]||n}function w(n){return["USD","EUR","GBP","CAD","AUD","JPY"].includes(n)}const M={mpesa:[{title:"Connecting to M-Pesa",text:"Establishing secure connection with Safaricom..."},{title:"Sending Payment Request",text:"Your phone will receive a payment prompt shortly..."},{title:"Awaiting Confirmation",text:"Please check your phone and enter your M-Pesa PIN to complete the payment..."},{title:"Verifying Payment",text:"Confirming your payment with M-Pesa..."},{title:"Finalizing Transaction",text:"Processing payment confirmation and updating your order..."}],paypal:[{title:"Connecting to PayPal",text:"Establishing secure connection..."},{title:"Processing Payment",text:"Completing your PayPal transaction..."},{title:"Finalizing Order",text:"Confirming payment and updating your order..."}]};function B(n,e,t){e.forEach(o=>{o.classList.toggle("active",o.dataset.method===n)}),t.textContent=N(n)}function $(n,e,t){const i={mpesa:{text:"Pay with M-Pesa",icon:"fas fa-mobile-alt"},paypal:{text:"Pay with PayPal",icon:"fab fa-paypal"}}[n];e.textContent=i.text,t.className=i.icon}function A(n,e,t,o){n==="paypal"&&!w(e)?(o.textContent=`Don't worry! PayPal doesn't support ${e}, but we'll automatically convert your payment to USD at the current exchange rate.`,t.style.display="flex"):q(t)}function q(n){n.style.display="none"}function R(n,e,t,o){e.classList.add("active");let i=0;function l(){const r=M[n]||M.mpesa;if(i<r.length){const s=r[i];t.textContent=s.title,o.textContent=s.text,i++,i<r.length&&setTimeout(l,2e3)}}l()}function p(n){n.classList.remove("active")}function I(n,e){const t=e.querySelector("span");t&&(t.textContent=n),e.className="payment-status info",e.style.display="flex"}function m(n,e){const t=e.querySelector("span");t&&(t.textContent=n),e.style.display="flex"}function L(n,e){const t=document.getElementById("paypal-status");if(!t)return;const o=t.querySelector("span");o&&(o.textContent=n),t.className=`payment-status ${e}`,t.style.display="flex"}function F(n){const e=document.getElementById("paypal-status");if(!e)return;const t=e.querySelector("span");t&&(t.textContent=n),e.className="payment-status error",e.style.display="flex"}function D(){const n=document.getElementById("paypal-status");if(!n)return;n.style.display="none";const e=n.querySelector("span");e&&(e.textContent="")}function O(n,e,t){n.classList.add("input-error"),n.classList.remove("input-success");const o=e.querySelector("span");o?o.textContent=t:e.innerHTML=`<i class="fas fa-exclamation-circle"></i> ${t}`,e.classList.add("show")}function _(n,e){n.classList.remove("input-error"),n.classList.add("input-success"),e.classList.remove("show")}function h(n,e){n?(e.classList.add("loading"),e.disabled=!0):(e.classList.remove("loading"),e.disabled=!1)}let y=!1,u=null;async function X(n){if(y)return console.warn("[MPESA] Payment already in progress"),!1;try{y=!0;const e=n.getState(),t=n.getElements(),o=n.getConfig(),i=t.phoneInput.value.trim(),l=x(i);if(!l)return m("Please enter a valid phone number",t.paymentErrors),y=!1,!1;h(!0,t.paymentSubmitButton),R("mpesa",t.processingModal,t.modalTitle,t.modalText);const r={order_id:o.orderId,provider:"MPESA",phone:l,amount:e.currentConvertedAmount,currency:e.currentCurrency},s=await fetchWithTimeout(o.urls.initiatePayment,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":o.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(r)},3e4),a=await s.json();if(!s.ok)return p(t.processingModal),h(!1,t.paymentSubmitButton),y=!1,m(a?.error||"Failed to initiate M-Pesa payment",t.paymentErrors),!1;if(a.success&&a.checkout_request_id){n.setState({lastCheckoutRequestId:a.checkout_request_id});const c=document.getElementById("checkoutRequestId");return c&&(c.value=a.checkout_request_id),b.setItem("lastCheckoutRequestId",a.checkout_request_id),t.modalTitle.textContent="Payment Sent to Phone",t.modalText.textContent="Please check your phone and approve the M-Pesa prompt.",j(a.checkout_request_id,n),!0}else return p(t.processingModal),h(!1,t.paymentSubmitButton),y=!1,m(a.error||"M-Pesa initiation failed",t.paymentErrors),!1}catch(e){console.error("[MPESA] Error:",e),p(n.getElements().processingModal),h(!1,n.getElements().paymentSubmitButton),y=!1;const t=e instanceof Error?e.message:"Network error. Please try again.";return m(t,n.getElements().paymentErrors),!1}}function j(n,e){const t=e.getElements(),o=e.getConfig();u!==null&&(clearInterval(u),u=null);const i=3e3,l=40;let r=0;u=window.setInterval(async()=>{if(r++,r%5===0&&I(`Still waiting for payment confirmation... (${r}/${l})`,t.paymentStatus),r>l){u!==null&&clearInterval(u),u=null,p(t.processingModal),h(!1,t.paymentSubmitButton),y=!1,m("Payment timed out. Please check your phone to complete the M-Pesa payment, or try again.",t.paymentErrors);return}try{const s=new URL(o.urls.mpesaStatus,window.location.origin);s.searchParams.set("checkout_request_id",n);const a=await fetch(s.toString(),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(!a.ok)throw new Error(`HTTP ${a.status}`);const c=await a.json();console.info("[MPESA] poll status:",c,`Attempt: ${r}/${l}`),c.status==="success"||c.status==="completed"?(u!==null&&clearInterval(u),u=null,t.modalTitle.textContent="Payment Confirmed!",t.modalText.textContent="Finalizing your order...",I("Payment confirmed! Finalizing order...",t.paymentStatus),H(n,e)):c.status==="failed"||c.status==="cancelled"||c.status==="error"?(u!==null&&clearInterval(u),u=null,p(t.processingModal),h(!1,t.paymentSubmitButton),y=!1,m(c.message||"Payment failed or was cancelled. Please try again.",t.paymentErrors)):r===1&&I("Payment initiated. Please check your phone and enter your M-Pesa PIN.",t.paymentStatus)}catch(s){console.error("[MPESA] polling error",s),r%10===0&&I("Having trouble checking payment status. Still trying...",t.paymentStatus)}},i)}let P=!1;function H(n,e){if(P){console.warn("[MPESA] Finalization already in progress, ignoring duplicate call");return}P=!0;const t=e.getElements(),o=e.getConfig(),i=e.getState(),l=n||i.lastCheckoutRequestId||document.getElementById("checkoutRequestId")?.value||localStorage.getItem("lastCheckoutRequestId");if(console.info("[MPESA] Finalizing payment with checkout_request_id:",l),!l){p(t.processingModal),h(!1,t.paymentSubmitButton),y=!1,P=!1,m("Missing M-Pesa transaction reference. Please retry.",t.paymentErrors);return}const r=new FormData;r.append("csrfmiddlewaretoken",o.csrfToken),r.append("order_id",o.orderId),r.append("payment_method","mpesa"),r.append("checkout_request_id",l),r.append("phone_number",t.phoneInput.value.trim()),r.append("amount",i.currentConvertedAmount.toString()),r.append("currency",i.currentCurrency),r.append("conversion_rate",i.currentRate.toString()),fetch(o.urls.processPayment,{method:"POST",headers:{"X-CSRFToken":o.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:r}).then(async s=>{const a=await s.json();if(console.info("[MPESA] finalize response:",a),!s.ok){if(a.message&&a.message.includes("already")){console.info("[MPESA] Order already processed, redirecting..."),t.modalTitle.textContent="Payment Complete!",t.modalText.textContent="Redirecting to your order...",setTimeout(()=>{p(t.processingModal),window.location.href=a.redirect_url||o.urls.orderSuccess},1e3);return}throw new Error(a.error_message||a.message||"Failed to verify M-Pesa payment")}a.success||a.status==="success"?(localStorage.removeItem("lastCheckoutRequestId"),localStorage.removeItem("paymentFormState"),t.modalTitle.textContent="Payment Successful!",t.modalText.textContent="Redirecting to your order confirmation...",setTimeout(()=>{p(t.processingModal),window.location.href=a.redirect_url||o.urls.orderSuccess},1500)):(p(t.processingModal),h(!1,t.paymentSubmitButton),y=!1,P=!1,m(a.message||a.error_message||"Payment verification failed",t.paymentErrors))}).catch(s=>{console.error("[MPESA] finalize error:",s),p(t.processingModal),h(!1,t.paymentSubmitButton),y=!1,P=!1,m(s.message||"Error finalizing payment",t.paymentErrors)})}function Y(){y=!1,P=!1,u!==null&&(clearInterval(u),u=null),console.info("[MPESA] Payment state reset")}let g=null;function k(n){D();const e=n.getState(),t=n.getElements(),o=n.getConfig(),i=document.getElementById("paypal-button-container");if(g){try{g.close()}catch(l){console.warn("Error closing PayPal buttons:",l)}i&&(i.innerHTML="")}if(!e.paypalInitialized)try{if(typeof window.paypal>"u"){console.error("PayPal SDK not loaded");const s=document.getElementById("paypal-fallback");s&&(s.style.display="block");return}let l=e.currentCurrency,r=e.currentConvertedAmount;if(!w(e.currentCurrency)&&e.currentCurrency!=="USD"){l="USD";const s=Array.from(t.currencySelector.options).find(a=>a.value==="USD");if(s){const a=parseFloat(s.dataset.rate||"1");r=parseFloat(o.cartTotalPrice)*a,L(`Your ${e.currentCurrency} ${C(e.currentConvertedAmount,e.currentCurrency)} payment will be processed as USD ${C(r,"USD")}.`,"info")}}if(g=window.paypal.Buttons({onInit:function(s,a){a.disable();const c=()=>{t.termsCheckbox&&t.termsCheckbox.checked?a.enable():a.disable()};t.termsCheckbox?.addEventListener("change",c)},onClick:function(s,a){if(!t.termsCheckbox.checked)return F("You must agree to the terms and conditions"),a.reject()},createOrder:function(s,a){const c=n.getState(),f=n.getConfig();let S=c.currentCurrency,d=c.currentConvertedAmount;if(!w(c.currentCurrency)&&c.currentCurrency!=="USD"){S="USD";const v=Array.from(t.currencySelector.options).find(E=>E.value==="USD");if(v){const E=parseFloat(v.dataset.rate||"1");d=parseFloat(f.cartTotalPrice)*E}}return console.log("Creating PayPal order:",{amount:d,currency:S,orderId:f.orderId}),a.order.create({purchase_units:[{amount:{value:d.toFixed(2),currency_code:S},description:`Order #${f.orderId}`,custom_id:f.orderId}]})},onApprove:function(s,a){return n.setState({paypalProcessing:!0}),R("paypal",t.processingModal,t.modalTitle,t.modalText),a.order.capture().then(function(c){const f=document.getElementById("paypalOrderId"),S=document.getElementById("paypalPayerId");f&&(f.value=s.orderID),S&&(S.value=c.payer.payer_id);const d=new FormData;if(d.append("csrfmiddlewaretoken",o.csrfToken),d.append("order_id",o.orderId),d.append("payment_method","paypal"),d.append("paypal_order_id",s.orderID),d.append("paypal_payer_id",c.payer.payer_id),d.append("amount",r.toFixed(2)),d.append("currency",l),!w(e.currentCurrency)&&e.currentCurrency!=="USD"){const v=Array.from(t.currencySelector.options).find(E=>E.value==="USD");d.append("conversion_rate",parseFloat(v?.dataset.rate||"1").toString())}else d.append("conversion_rate","1");G(d,n)}).catch(function(c){console.error("PayPal capture error:",c),p(t.processingModal),m("Failed to complete PayPal payment. Please try again.",t.paymentErrors),n.setState({paypalProcessing:!1})})},onError:function(s){console.error("PayPal error:",s),F("PayPal payment failed. Please try another method."),n.setState({paypalProcessing:!1})},onCancel:function(s){n.setState({paypalProcessing:!1}),L("Payment canceled","info")}}),g&&g.isEligible())g.render("#paypal-button-container").then(()=>{console.log("PayPal buttons rendered successfully"),n.setState({paypalInitialized:!0});const s=document.getElementById("paypal-fallback");s&&(s.style.display="none")}).catch(s=>{console.error("Error rendering PayPal buttons",s);const a=document.getElementById("paypal-fallback");a&&(a.style.display="block")});else{console.log("PayPal buttons not eligible");const s=document.getElementById("paypal-fallback");s&&(s.style.display="block")}}catch(l){console.error("PayPal initialization error:",l);const r=document.getElementById("paypal-fallback");r&&(r.style.display="block")}}function W(){if(g){try{g.close()}catch(e){console.log("Error closing PayPal buttons:",e)}const n=document.getElementById("paypal-button-container");n&&(n.innerHTML=""),g=null}}function G(n,e){const t=e.getElements(),o=e.getConfig();fetch(o.urls.processPayment,{method:"POST",body:n,headers:{"X-CSRFToken":o.csrfToken,"X-Requested-With":"XMLHttpRequest"}}).then(i).catch(l);function i(r){return r.ok?r.json().then(s=>{s.success?(b.removeItem("paymentFormState"),b.removeItem("lastCheckoutRequestId"),t.modalTitle.textContent="Payment Successful!",t.modalText.textContent="Redirecting you to your order confirmation...",setTimeout(()=>{p(t.processingModal),window.location.href=s.redirect_url||o.urls.orderSuccess},2e3)):(p(t.processingModal),m(s.error_message||"Payment failed",t.paymentErrors),h(!1,t.paymentSubmitButton))}):Promise.reject(r)}function l(r){p(t.processingModal),h(!1,t.paymentSubmitButton),r.json?r.json().then(s=>{m(s.error_message||"Unexpected error occurred",t.paymentErrors)}).catch(()=>{m("Network error. Please check your connection.",t.paymentErrors)}):m("Network error. Please check your connection.",t.paymentErrors)}}function V(){try{const n=document.getElementById("paypal-button-container");n&&(n.innerHTML="");const e=document.getElementById("paypal-fallback");e&&(e.style.display="none"),D(),g=null,console.info("[PayPal] Payment state reset successfully.")}catch(n){console.error("[PayPal] Error resetting payment state:",n)}}class J{config;state;elements;formSubmitted=!1;constructor(e){this.config=e,this.state={currentMethod:"mpesa",currentCurrency:e.defaultCurrency,currentRate:1,currentConvertedAmount:parseFloat(e.cartTotalPrice),paypalInitialized:!1,paypalProcessing:!1,processingStage:0},this.elements={},this.init()}init(){this.cacheElements(),this.bindEvents(),this.restoreState(),this.checkExistingPayment(),this.initializePaymentMethod(this.state.currentMethod)}checkExistingPayment(){const e=localStorage.getItem("lastCheckoutRequestId");e&&(console.warn("[PAYMENT] Found existing checkout request ID:",e),I("You have a payment in progress. Please complete it or wait for it to expire.",this.elements.paymentStatus))}cacheElements(){this.elements={formAmount:document.getElementById("formAmount"),paymentForm:document.getElementById("paymentForm"),processingModal:document.getElementById("processingModal"),modalTitle:document.getElementById("modalTitle"),modalText:document.getElementById("modalText"),paymentStatus:document.getElementById("paymentStatus"),paymentErrors:document.getElementById("paymentErrors"),selectedMethodInput:document.getElementById("selectedMethod"),currencySelector:document.getElementById("currencySelector"),currencyTooltip:document.getElementById("currencyTooltip"),tooltipText:document.getElementById("tooltipText"),methodConfirmation:document.getElementById("methodConfirmation"),selectedMethodName:document.getElementById("selectedMethodName"),paymentSubmitButton:document.getElementById("paymentSubmitButton"),submitText:document.getElementById("submitText"),submitIcon:document.getElementById("submitIcon"),formCurrency:document.getElementById("formCurrency"),formConversionRate:document.getElementById("formConversionRate"),mobileMoneySection:document.getElementById("mobileMoneySection"),paypalSection:document.getElementById("paypalSection"),paymentTabs:document.querySelectorAll(".payment-tab"),phoneInput:document.getElementById("phoneNumber"),phoneError:document.getElementById("phoneError"),termsCheckbox:document.getElementById("termsAgreement"),summaryToggle:document.getElementById("summaryToggle"),summaryContent:document.getElementById("summaryContent")}}bindEvents(){this.elements.paymentTabs.forEach(e=>{e.addEventListener("click",()=>{e.classList.contains("active")||this.switchPaymentMethod(e.dataset.method)})}),this.elements.currencySelector.addEventListener("change",e=>{this.handleCurrencyChange(e.target)}),this.elements.phoneInput.addEventListener("input",e=>{this.handlePhoneInput(e.target.value)}),this.elements.termsCheckbox.addEventListener("change",()=>{this.handleTermsChange()}),this.elements.paymentForm.addEventListener("submit",e=>{this.handleFormSubmit(e)}),this.elements.summaryToggle.addEventListener("click",()=>{this.toggleSummary()}),window.addEventListener("resize",()=>{this.handleResize()}),window.addEventListener("beforeunload",e=>{if(this.formSubmitted)return e.preventDefault(),e.returnValue="Payment is in progress. Are you sure you want to leave?",e.returnValue}),window.addEventListener("unload",()=>{this.formSubmitted||storage.removeItem("paymentFormState")}),window.addEventListener("popstate",e=>{this.formSubmitted&&(confirm("Payment is in progress. Are you sure you want to go back?")||window.history.pushState(null,"",window.location.href))})}restoreState(){const e=U();this.state.currentMethod=e.method||"mpesa",this.state.currentCurrency=e.currency||this.config.defaultCurrency,e.phone&&(this.elements.phoneInput.value=e.phone),e.terms&&(this.elements.termsCheckbox.checked=!0)}switchPaymentMethod(e){Y(),V(),this.state.currentMethod=e,B(e,this.elements.paymentTabs,this.elements.selectedMethodName),$(e,this.elements.submitText,this.elements.submitIcon),this.elements.selectedMethodInput.value=e,this.togglePaymentSections(e),e==="paypal"?(A(e,this.state.currentCurrency,this.elements.currencyTooltip,this.elements.tooltipText),console.log("[PAYMENT] Switching to PayPal... Terms checked?",this.elements.termsCheckbox.checked),this.elements.termsCheckbox.checked?(console.log("✅ Initializing PayPal..."),setTimeout(()=>k(this),400)):console.warn("⚠️ PayPal not initialized because terms are unchecked.")):(q(this.elements.currencyTooltip),W()),T({method:e,currency:this.state.currentCurrency,phone:this.elements.phoneInput.value,terms:this.elements.termsCheckbox.checked})}togglePaymentSections(e){e==="paypal"?(this.elements.mobileMoneySection.classList.remove("active"),setTimeout(()=>{this.elements.mobileMoneySection.style.display="none",this.elements.paypalSection.style.display="block",setTimeout(()=>this.elements.paypalSection.classList.add("active"),50)},300)):(this.elements.paypalSection.classList.remove("active"),setTimeout(()=>{this.elements.paypalSection.style.display="none",this.elements.mobileMoneySection.style.display="block",setTimeout(()=>this.elements.mobileMoneySection.classList.add("active"),50)},300))}handleCurrencyChange(e){const t=e.options[e.selectedIndex],o=t.value,i=parseFloat(t.dataset.rate||"1");this.state.currentCurrency=o,this.state.currentRate=i,this.elements.formCurrency.value=o,this.elements.formConversionRate.value=i.toString(),this.updateAmounts(i,o),this.state.currentMethod==="paypal"&&(this.state.paypalInitialized=!1,A("paypal",o,this.elements.currencyTooltip,this.elements.tooltipText),setTimeout(()=>k(this),500)),T({method:this.state.currentMethod,currency:o,phone:this.elements.phoneInput.value,terms:this.elements.termsCheckbox.checked})}updateAmounts(e,t){const o=this.config.currencySymbols[t]||t,i=parseFloat(this.config.cartTotalPrice);this.state.currentConvertedAmount=i*e,document.querySelectorAll(".order-item").forEach(a=>{const c=parseFloat(a.dataset.price||"0"),f=a.querySelector(".item-amount");f&&(f.textContent=C(c*e,t))});const l=document.querySelector(".subtotal-amount"),r=document.querySelector(".total-amount");l&&(l.textContent=C(this.state.currentConvertedAmount,t)),r&&(r.textContent=C(this.state.currentConvertedAmount,t)),this.elements.formAmount.value=this.state.currentConvertedAmount.toFixed(2);const s=document.getElementById("amount");s&&(s.value=`${t} ${C(this.state.currentConvertedAmount,t)}`),document.querySelectorAll(".currency-symbol").forEach(a=>{a.textContent=o})}handlePhoneInput(e){e&&x(e)&&_(this.elements.phoneInput,this.elements.phoneError),T({method:this.state.currentMethod,currency:this.state.currentCurrency,phone:e,terms:this.elements.termsCheckbox.checked})}handleTermsChange(){T({method:this.state.currentMethod,currency:this.state.currentCurrency,phone:this.elements.phoneInput.value,terms:this.elements.termsCheckbox.checked}),this.state.currentMethod==="paypal"&&this.elements.termsCheckbox.checked&&setTimeout(()=>k(this),300)}async handleFormSubmit(e){if(e.preventDefault(),this.formSubmitted){console.warn("[PAYMENT] Form already submitted, ignoring duplicate submission");return}if(this.elements.paymentErrors.style.display="none",!this.validateForm())return;const t=this.state.currentMethod;if(t==="paypal"){const o=document.getElementById("paypal-button-container");o&&o.scrollIntoView({behavior:"smooth",block:"center"});return}t==="mpesa"&&(this.formSubmitted=!0,await X(this)||(this.formSubmitted=!1))}validateForm(){let e=!0;if(this.state.currentMethod==="mpesa"){const t=this.elements.phoneInput.value.trim();x(t)?_(this.elements.phoneInput,this.elements.phoneError):(O(this.elements.phoneInput,this.elements.phoneError,"Please enter a valid phone number (e.g. 712345678)"),e=!1)}return this.elements.termsCheckbox.checked||(m("You must agree to the terms and conditions",this.elements.paymentErrors),e=!1),e}toggleSummary(){if(this.elements.summaryContent.classList.contains("collapsed")){this.elements.summaryContent.classList.remove("collapsed"),this.elements.summaryToggle.classList.remove("collapsed");const t=this.elements.summaryToggle.querySelector("span");t&&(t.textContent="Hide Details");const o=this.elements.summaryToggle.querySelector("i");o&&(o.style.transform="rotate(180deg)")}else{this.elements.summaryContent.classList.add("collapsed"),this.elements.summaryToggle.classList.add("collapsed");const t=this.elements.summaryToggle.querySelector("span");t&&(t.textContent="Show Details");const o=this.elements.summaryToggle.querySelector("i");o&&(o.style.transform="rotate(0deg)")}}handleResize(){if(window.innerWidth<=991&&!this.elements.summaryContent.classList.contains("collapsed")){if(!this.elements.summaryToggle.classList.contains("initialized")){this.elements.summaryContent.classList.add("collapsed"),this.elements.summaryToggle.classList.add("collapsed");const e=this.elements.summaryToggle.querySelector("span");e&&(e.textContent="Show Details"),this.elements.summaryToggle.classList.add("initialized")}}else window.innerWidth>991&&(this.elements.summaryContent.classList.remove("collapsed"),this.elements.summaryToggle.classList.remove("collapsed"))}isPaypalCurrencySupported(e){return["USD","EUR","GBP","CAD","AUD","JPY"].includes(e)}initializePaymentMethod(e){if(B(e,this.elements.paymentTabs,this.elements.selectedMethodName),this.switchPaymentMethod(e),window.innerWidth<=991){this.elements.summaryContent.classList.add("collapsed"),this.elements.summaryToggle.classList.add("collapsed");const t=this.elements.summaryToggle.querySelector("span");t&&(t.textContent="Show Details")}}getState(){return{...this.state}}setState(e){this.state={...this.state,...e}}getElements(){return{...this.elements}}getConfig(){return{...this.config}}}document.addEventListener("DOMContentLoaded",function(){if(typeof window.paymentConfig>"u"){console.error("paymentConfig missing. Make sure checkout template injects it.");return}const n=window.paymentConfig,e={cartTotalPrice:n.cartTotalPrice,defaultCurrency:n.defaultCurrency,csrfToken:n.csrfToken,currencySymbols:{USD:"$",EUR:"€",GBP:"£",KES:"KSh",UGX:"USh",TZS:"TSh"},orderId:n.orderId,paypalClientId:n.paypalClientId,urls:n.urls};window.paymentSystem=new J(e)});
