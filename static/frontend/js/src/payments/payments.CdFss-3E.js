function x(n){if(!n)return!1;const e=n.trim().replace(/\s+/g,""),t=/^(?:254|\+254|0)?(7[0-9]{8})$/,s=e.match(t);return s?`254${s[1]}`:!1}function C(n,e){const t=e==="UGX"||e==="TZS"?0:2;return n.toLocaleString("en-US",{minimumFractionDigits:t,maximumFractionDigits:t})}function T(n){localStorage.setItem("paymentFormState",JSON.stringify(n))}function D(){return JSON.parse(localStorage.getItem("paymentFormState")||"{}")}function U(n){return{mpesa:"M-Pesa",paypal:"PayPal"}[n]||n}function k(n){return["USD","EUR","GBP","CAD","AUD","JPY"].includes(n)}const M={mpesa:[{title:"Connecting to M-Pesa",text:"Establishing secure connection with Safaricom..."},{title:"Sending Payment Request",text:"Your phone will receive a payment prompt shortly..."},{title:"Awaiting Confirmation",text:"Please check your phone and enter your M-Pesa PIN to complete the payment..."},{title:"Verifying Payment",text:"Confirming your payment with M-Pesa..."},{title:"Finalizing Transaction",text:"Processing payment confirmation and updating your order..."}],paypal:[{title:"Connecting to PayPal",text:"Establishing secure connection..."},{title:"Processing Payment",text:"Completing your PayPal transaction..."},{title:"Finalizing Order",text:"Confirming payment and updating your order..."}]};function w(n,e,t){e.forEach(s=>{s.classList.toggle("active",s.dataset.method===n)}),t.textContent=U(n)}function z(n,e,t){const l={mpesa:{text:"Pay with M-Pesa",icon:"fas fa-mobile-alt"},paypal:{text:"Pay with PayPal",icon:"fab fa-paypal"}}[n];e.textContent=l.text,t.className=l.icon}function B(n,e,t,s){n==="paypal"&&!k(e)?(s.textContent=`Don't worry! PayPal doesn't support ${e}, but we'll automatically convert your payment to USD at the current exchange rate.`,t.style.display="flex"):F(t)}function F(n){n.style.display="none"}function _(n,e,t,s){e.classList.add("active");let l=0;function c(){const a=M[n]||M.mpesa;if(l<a.length){const o=a[l];t.textContent=o.title,s.textContent=o.text,l++,l<a.length&&setTimeout(c,2e3)}}c()}function y(n){n.classList.remove("active")}function E(n,e){const t=e.querySelector("span");t&&(t.textContent=n),e.className="payment-status info",e.style.display="flex"}function d(n,e){const t=e.querySelector("span");t&&(t.textContent=n),e.style.display="flex"}function A(n,e){const t=document.getElementById("paypal-status");if(!t)return;const s=t.querySelector("span");s&&(s.textContent=n),t.className=`payment-status ${e}`,t.style.display="flex"}function L(n){const e=document.getElementById("paypal-status");if(!e)return;const t=e.querySelector("span");t&&(t.textContent=n),e.className="payment-status error",e.style.display="flex"}function R(){const n=document.getElementById("paypal-status");if(!n)return;n.style.display="none";const e=n.querySelector("span");e&&(e.textContent="")}function N(n,e,t){n.classList.add("input-error"),n.classList.remove("input-success");const s=e.querySelector("span");s?s.textContent=t:e.innerHTML=`<i class="fas fa-exclamation-circle"></i> ${t}`,e.classList.add("show")}function q(n,e){n.classList.remove("input-error"),n.classList.add("input-success"),e.classList.remove("show")}function f(n,e){n?(e.classList.add("loading"),e.disabled=!0):(e.classList.remove("loading"),e.disabled=!1)}let h=!1,m=null;async function $(n){if(h)return console.warn("[MPESA] Payment already in progress, ignoring duplicate attempt"),!1;try{h=!0;const e=n.getState(),t=n.getElements(),s=n.getConfig(),l=t.phoneInput.value.trim(),c=x(l);if(!c)return d("Please enter a valid phone number",t.paymentErrors),h=!1,!1;f(!0,t.paymentSubmitButton),_("mpesa",t.processingModal,t.modalTitle,t.modalText);const a={order_id:s.orderId,provider:"MPESA",phone:c,amount:e.currentConvertedAmount,currency:e.currentCurrency};console.info("[MPESA] Initiating payment request payload:",a);const o=s.urls.initiatePayment,r=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":s.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify(a)}),i=await r.json();if(console.info("[MPESA] Initiate response:",i),!r.ok){y(t.processingModal),f(!1,t.paymentSubmitButton),h=!1;const u=i?.error||i?.message||"Failed to initiate M-Pesa payment";return d(u,t.paymentErrors),!1}if(i.success&&i.checkout_request_id){n.setState({lastCheckoutRequestId:i.checkout_request_id});try{const u=document.getElementById("checkoutRequestId");u&&(u.value=i.checkout_request_id)}catch{}return localStorage.setItem("lastCheckoutRequestId",i.checkout_request_id),t.modalTitle.textContent="Payment Sent to Phone",t.modalText.textContent="Please check your phone and approve the M-Pesa prompt.",E("M-Pesa payment requested – awaiting confirmation on phone.",t.paymentStatus),O(i.checkout_request_id,n),!0}else{y(t.processingModal),f(!1,t.paymentSubmitButton),h=!1;const u=i.error||i.message||"M-Pesa initiation failed";return d(u,t.paymentErrors),!1}}catch(e){console.error("M-PESA error:",e);const t=e instanceof Error?e:new Error("Unknown error");return y(n.getElements().processingModal),d(t.message||"Network error. Please try again.",n.getElements().paymentErrors),f(!1,n.getElements().paymentSubmitButton),h=!1,!1}}function O(n,e){const t=e.getElements(),s=e.getConfig();m!==null&&(clearInterval(m),m=null);const l=3e3,c=40;let a=0;m=window.setInterval(async()=>{if(a++,a%5===0&&E(`Still waiting for payment confirmation... (${a}/${c})`,t.paymentStatus),a>c){m!==null&&clearInterval(m),m=null,y(t.processingModal),f(!1,t.paymentSubmitButton),h=!1,d("Payment timed out. Please check your phone to complete the M-Pesa payment, or try again.",t.paymentErrors);return}try{const o=new URL(s.urls.mpesaStatus,window.location.origin);o.searchParams.set("checkout_request_id",n);const r=await fetch(o.toString(),{method:"GET",headers:{"X-Requested-With":"XMLHttpRequest"}});if(!r.ok)throw new Error(`HTTP ${r.status}`);const i=await r.json();console.info("[MPESA] poll status:",i,`Attempt: ${a}/${c}`),i.status==="success"||i.status==="completed"?(m!==null&&clearInterval(m),m=null,t.modalTitle.textContent="Payment Confirmed!",t.modalText.textContent="Finalizing your order...",E("Payment confirmed! Finalizing order...",t.paymentStatus),X(n,e)):i.status==="failed"||i.status==="cancelled"||i.status==="error"?(m!==null&&clearInterval(m),m=null,y(t.processingModal),f(!1,t.paymentSubmitButton),h=!1,d(i.message||"Payment failed or was cancelled. Please try again.",t.paymentErrors)):a===1&&E("Payment initiated. Please check your phone and enter your M-Pesa PIN.",t.paymentStatus)}catch(o){console.error("[MPESA] polling error",o),a%10===0&&E("Having trouble checking payment status. Still trying...",t.paymentStatus)}},l)}let S=!1;function X(n,e){if(S){console.warn("[MPESA] Finalization already in progress, ignoring duplicate call");return}S=!0;const t=e.getElements(),s=e.getConfig(),l=e.getState(),c=n||l.lastCheckoutRequestId||document.getElementById("checkoutRequestId")?.value||localStorage.getItem("lastCheckoutRequestId");if(console.info("[MPESA] Finalizing payment with checkout_request_id:",c),!c){y(t.processingModal),f(!1,t.paymentSubmitButton),h=!1,S=!1,d("Missing M-Pesa transaction reference. Please retry.",t.paymentErrors);return}const a=new FormData;a.append("csrfmiddlewaretoken",s.csrfToken),a.append("order_id",s.orderId),a.append("payment_method","mpesa"),a.append("checkout_request_id",c),a.append("phone_number",t.phoneInput.value.trim()),a.append("amount",l.currentConvertedAmount.toString()),a.append("currency",l.currentCurrency),a.append("conversion_rate",l.currentRate.toString()),fetch(s.urls.processPayment,{method:"POST",headers:{"X-CSRFToken":s.csrfToken,"X-Requested-With":"XMLHttpRequest"},body:a}).then(async o=>{const r=await o.json();if(console.info("[MPESA] finalize response:",r),!o.ok){if(r.message&&r.message.includes("already")){console.info("[MPESA] Order already processed, redirecting..."),t.modalTitle.textContent="Payment Complete!",t.modalText.textContent="Redirecting to your order...",setTimeout(()=>{y(t.processingModal),window.location.href=r.redirect_url||s.urls.orderSuccess},1e3);return}throw new Error(r.error_message||r.message||"Failed to verify M-Pesa payment")}r.success||r.status==="success"?(localStorage.removeItem("lastCheckoutRequestId"),localStorage.removeItem("paymentFormState"),t.modalTitle.textContent="Payment Successful!",t.modalText.textContent="Redirecting to your order confirmation...",setTimeout(()=>{y(t.processingModal),window.location.href=r.redirect_url||s.urls.orderSuccess},1500)):(y(t.processingModal),f(!1,t.paymentSubmitButton),h=!1,S=!1,d(r.message||r.error_message||"Payment verification failed",t.paymentErrors))}).catch(o=>{console.error("[MPESA] finalize error:",o),y(t.processingModal),f(!1,t.paymentSubmitButton),h=!1,S=!1,d(o.message||"Error finalizing payment",t.paymentErrors)})}function j(){h=!1,S=!1,m!==null&&(clearInterval(m),m=null),console.info("[MPESA] Payment state reset")}let g=null;function v(n){R();const e=n.getState(),t=n.getElements(),s=n.getConfig(),l=document.getElementById("paypal-button-container");if(g){try{g.close()}catch(c){console.warn("Error closing PayPal buttons:",c)}l&&(l.innerHTML="")}if(!e.paypalInitialized)try{if(typeof window.paypal>"u"){console.error("PayPal SDK not loaded");const o=document.getElementById("paypal-fallback");o&&(o.style.display="block");return}let c=e.currentCurrency,a=e.currentConvertedAmount;if(!k(e.currentCurrency)&&e.currentCurrency!=="USD"){c="USD";const o=Array.from(t.currencySelector.options).find(r=>r.value==="USD");if(o){const r=parseFloat(o.dataset.rate||"1");a=parseFloat(s.cartTotalPrice)*r,A(`Your ${e.currentCurrency} ${C(e.currentConvertedAmount,e.currentCurrency)} payment will be processed as USD ${C(a,"USD")}.`,"info")}}if(g=window.paypal.Buttons({onInit:function(o,r){r.disable();const i=()=>{t.termsCheckbox&&t.termsCheckbox.checked?r.enable():r.disable()};t.termsCheckbox?.addEventListener("change",i)},onClick:function(o,r){if(!t.termsCheckbox.checked)return L("You must agree to the terms and conditions"),r.reject()},createOrder:function(o,r){const i=n.getState(),u=n.getConfig();let P=i.currentCurrency,p=i.currentConvertedAmount;if(!k(i.currentCurrency)&&i.currentCurrency!=="USD"){P="USD";const b=Array.from(t.currencySelector.options).find(I=>I.value==="USD");if(b){const I=parseFloat(b.dataset.rate||"1");p=parseFloat(u.cartTotalPrice)*I}}return console.log("Creating PayPal order:",{amount:p,currency:P,orderId:u.orderId}),r.order.create({purchase_units:[{amount:{value:p.toFixed(2),currency_code:P},description:`Order #${u.orderId}`,custom_id:u.orderId}]})},onApprove:function(o,r){return n.setState({paypalProcessing:!0}),_("paypal",t.processingModal,t.modalTitle,t.modalText),r.order.capture().then(function(i){const u=document.getElementById("paypalOrderId"),P=document.getElementById("paypalPayerId");u&&(u.value=o.orderID),P&&(P.value=i.payer.payer_id);const p=new FormData;if(p.append("csrfmiddlewaretoken",s.csrfToken),p.append("order_id",s.orderId),p.append("payment_method","paypal"),p.append("paypal_order_id",o.orderID),p.append("paypal_payer_id",i.payer.payer_id),p.append("amount",a.toFixed(2)),p.append("currency",c),!k(e.currentCurrency)&&e.currentCurrency!=="USD"){const b=Array.from(t.currencySelector.options).find(I=>I.value==="USD");p.append("conversion_rate",parseFloat(b?.dataset.rate||"1").toString())}else p.append("conversion_rate","1");Y(p,n)}).catch(function(i){console.error("PayPal capture error:",i),y(t.processingModal),d("Failed to complete PayPal payment. Please try again.",t.paymentErrors),n.setState({paypalProcessing:!1})})},onError:function(o){console.error("PayPal error:",o),L("PayPal payment failed. Please try another method."),n.setState({paypalProcessing:!1})},onCancel:function(o){n.setState({paypalProcessing:!1}),A("Payment canceled","info")}}),g&&g.isEligible())g.render("#paypal-button-container").then(()=>{console.log("PayPal buttons rendered successfully"),n.setState({paypalInitialized:!0});const o=document.getElementById("paypal-fallback");o&&(o.style.display="none")}).catch(o=>{console.error("Error rendering PayPal buttons",o);const r=document.getElementById("paypal-fallback");r&&(r.style.display="block")});else{console.log("PayPal buttons not eligible");const o=document.getElementById("paypal-fallback");o&&(o.style.display="block")}}catch(c){console.error("PayPal initialization error:",c);const a=document.getElementById("paypal-fallback");a&&(a.style.display="block")}}function H(){if(g){try{g.close()}catch(e){console.log("Error closing PayPal buttons:",e)}const n=document.getElementById("paypal-button-container");n&&(n.innerHTML=""),g=null}}function Y(n,e){const t=e.getElements(),s=e.getConfig();fetch(s.urls.processPayment,{method:"POST",body:n,headers:{"X-CSRFToken":s.csrfToken,"X-Requested-With":"XMLHttpRequest"}}).then(l).catch(c);function l(a){return a.ok?a.json().then(o=>{o.success?(localStorage.removeItem("paymentFormState"),t.modalTitle.textContent="Payment Successful!",t.modalText.textContent="Redirecting you to your order confirmation...",setTimeout(()=>{y(t.processingModal),window.location.href=o.redirect_url||s.urls.orderSuccess},2e3)):(y(t.processingModal),d(o.error_message||"Payment failed",t.paymentErrors),f(!1,t.paymentSubmitButton))}):Promise.reject(a)}function c(a){y(t.processingModal),f(!1,t.paymentSubmitButton),a.json?a.json().then(o=>{d(o.error_message||"Unexpected error occurred",t.paymentErrors)}).catch(()=>{d("Network error. Please check your connection.",t.paymentErrors)}):d("Network error. Please check your connection.",t.paymentErrors)}}function W(){try{const n=document.getElementById("paypal-button-container");n&&(n.innerHTML="");const e=document.getElementById("paypal-fallback");e&&(e.style.display="none"),R(),g=null,console.info("[PayPal] Payment state reset successfully.")}catch(n){console.error("[PayPal] Error resetting payment state:",n)}}class G{config;state;elements;formSubmitted=!1;constructor(e){this.config=e,this.state={currentMethod:"mpesa",currentCurrency:e.defaultCurrency,currentRate:1,currentConvertedAmount:parseFloat(e.cartTotalPrice),paypalInitialized:!1,paypalProcessing:!1,processingStage:0},this.elements={},this.init()}init(){this.cacheElements(),this.bindEvents(),this.restoreState(),this.checkExistingPayment(),this.initializePaymentMethod(this.state.currentMethod)}checkExistingPayment(){const e=localStorage.getItem("lastCheckoutRequestId");e&&(console.warn("[PAYMENT] Found existing checkout request ID:",e),E("You have a payment in progress. Please complete it or wait for it to expire.",this.elements.paymentStatus))}cacheElements(){this.elements={formAmount:document.getElementById("formAmount"),paymentForm:document.getElementById("paymentForm"),processingModal:document.getElementById("processingModal"),modalTitle:document.getElementById("modalTitle"),modalText:document.getElementById("modalText"),paymentStatus:document.getElementById("paymentStatus"),paymentErrors:document.getElementById("paymentErrors"),selectedMethodInput:document.getElementById("selectedMethod"),currencySelector:document.getElementById("currencySelector"),currencyTooltip:document.getElementById("currencyTooltip"),tooltipText:document.getElementById("tooltipText"),methodConfirmation:document.getElementById("methodConfirmation"),selectedMethodName:document.getElementById("selectedMethodName"),paymentSubmitButton:document.getElementById("paymentSubmitButton"),submitText:document.getElementById("submitText"),submitIcon:document.getElementById("submitIcon"),formCurrency:document.getElementById("formCurrency"),formConversionRate:document.getElementById("formConversionRate"),mobileMoneySection:document.getElementById("mobileMoneySection"),paypalSection:document.getElementById("paypalSection"),paymentTabs:document.querySelectorAll(".payment-tab"),phoneInput:document.getElementById("phoneNumber"),phoneError:document.getElementById("phoneError"),termsCheckbox:document.getElementById("termsAgreement"),summaryToggle:document.getElementById("summaryToggle"),summaryContent:document.getElementById("summaryContent")}}bindEvents(){this.elements.paymentTabs.forEach(e=>{e.addEventListener("click",()=>{e.classList.contains("active")||this.switchPaymentMethod(e.dataset.method)})}),this.elements.currencySelector.addEventListener("change",e=>{this.handleCurrencyChange(e.target)}),this.elements.phoneInput.addEventListener("input",e=>{this.handlePhoneInput(e.target.value)}),this.elements.termsCheckbox.addEventListener("change",()=>{this.handleTermsChange()}),this.elements.paymentForm.addEventListener("submit",e=>{this.handleFormSubmit(e)}),this.elements.summaryToggle.addEventListener("click",()=>{this.toggleSummary()}),window.addEventListener("resize",()=>{this.handleResize()}),window.addEventListener("beforeunload",e=>{if(this.formSubmitted)return e.preventDefault(),e.returnValue="Payment is in progress. Are you sure you want to leave?",e.returnValue})}restoreState(){const e=D();this.state.currentMethod=e.method||"mpesa",this.state.currentCurrency=e.currency||this.config.defaultCurrency,e.phone&&(this.elements.phoneInput.value=e.phone),e.terms&&(this.elements.termsCheckbox.checked=!0)}switchPaymentMethod(e){j(),W(),this.state.currentMethod=e,w(e,this.elements.paymentTabs,this.elements.selectedMethodName),z(e,this.elements.submitText,this.elements.submitIcon),this.elements.selectedMethodInput.value=e,this.togglePaymentSections(e),e==="paypal"?(B(e,this.state.currentCurrency,this.elements.currencyTooltip,this.elements.tooltipText),console.log("[PAYMENT] Switching to PayPal... Terms checked?",this.elements.termsCheckbox.checked),this.elements.termsCheckbox.checked?(console.log("✅ Initializing PayPal..."),setTimeout(()=>v(this),400)):console.warn("⚠️ PayPal not initialized because terms are unchecked.")):(F(this.elements.currencyTooltip),H()),T({method:e,currency:this.state.currentCurrency,phone:this.elements.phoneInput.value,terms:this.elements.termsCheckbox.checked})}togglePaymentSections(e){e==="paypal"?(this.elements.mobileMoneySection.classList.remove("active"),setTimeout(()=>{this.elements.mobileMoneySection.style.display="none",this.elements.paypalSection.style.display="block",setTimeout(()=>this.elements.paypalSection.classList.add("active"),50)},300)):(this.elements.paypalSection.classList.remove("active"),setTimeout(()=>{this.elements.paypalSection.style.display="none",this.elements.mobileMoneySection.style.display="block",setTimeout(()=>this.elements.mobileMoneySection.classList.add("active"),50)},300))}handleCurrencyChange(e){const t=e.options[e.selectedIndex],s=t.value,l=parseFloat(t.dataset.rate||"1");this.state.currentCurrency=s,this.state.currentRate=l,this.elements.formCurrency.value=s,this.elements.formConversionRate.value=l.toString(),this.updateAmounts(l,s),this.state.currentMethod==="paypal"&&(this.state.paypalInitialized=!1,B("paypal",s,this.elements.currencyTooltip,this.elements.tooltipText),setTimeout(()=>v(this),500)),T({method:this.state.currentMethod,currency:s,phone:this.elements.phoneInput.value,terms:this.elements.termsCheckbox.checked})}updateAmounts(e,t){const s=this.config.currencySymbols[t]||t,l=parseFloat(this.config.cartTotalPrice);this.state.currentConvertedAmount=l*e,document.querySelectorAll(".order-item").forEach(r=>{const i=parseFloat(r.dataset.price||"0"),u=r.querySelector(".item-amount");u&&(u.textContent=C(i*e,t))});const c=document.querySelector(".subtotal-amount"),a=document.querySelector(".total-amount");c&&(c.textContent=C(this.state.currentConvertedAmount,t)),a&&(a.textContent=C(this.state.currentConvertedAmount,t)),this.elements.formAmount.value=this.state.currentConvertedAmount.toFixed(2);const o=document.getElementById("amount");o&&(o.value=`${t} ${C(this.state.currentConvertedAmount,t)}`),document.querySelectorAll(".currency-symbol").forEach(r=>{r.textContent=s})}handlePhoneInput(e){e&&x(e)&&q(this.elements.phoneInput,this.elements.phoneError),T({method:this.state.currentMethod,currency:this.state.currentCurrency,phone:e,terms:this.elements.termsCheckbox.checked})}handleTermsChange(){T({method:this.state.currentMethod,currency:this.state.currentCurrency,phone:this.elements.phoneInput.value,terms:this.elements.termsCheckbox.checked}),this.state.currentMethod==="paypal"&&this.elements.termsCheckbox.checked&&setTimeout(()=>v(this),300)}async handleFormSubmit(e){if(e.preventDefault(),this.formSubmitted){console.warn("[PAYMENT] Form already submitted, ignoring duplicate submission");return}if(this.elements.paymentErrors.style.display="none",!this.validateForm())return;const t=this.state.currentMethod;if(t==="paypal"){const s=document.getElementById("paypal-button-container");s&&s.scrollIntoView({behavior:"smooth",block:"center"});return}t==="mpesa"&&(this.formSubmitted=!0,await $(this)||(this.formSubmitted=!1))}validateForm(){let e=!0;if(this.state.currentMethod==="mpesa"){const t=this.elements.phoneInput.value.trim();x(t)?q(this.elements.phoneInput,this.elements.phoneError):(N(this.elements.phoneInput,this.elements.phoneError,"Please enter a valid phone number (e.g. 712345678)"),e=!1)}return this.elements.termsCheckbox.checked||(d("You must agree to the terms and conditions",this.elements.paymentErrors),e=!1),e}toggleSummary(){if(this.elements.summaryContent.classList.contains("collapsed")){this.elements.summaryContent.classList.remove("collapsed"),this.elements.summaryToggle.classList.remove("collapsed");const t=this.elements.summaryToggle.querySelector("span");t&&(t.textContent="Hide Details");const s=this.elements.summaryToggle.querySelector("i");s&&(s.style.transform="rotate(180deg)")}else{this.elements.summaryContent.classList.add("collapsed"),this.elements.summaryToggle.classList.add("collapsed");const t=this.elements.summaryToggle.querySelector("span");t&&(t.textContent="Show Details");const s=this.elements.summaryToggle.querySelector("i");s&&(s.style.transform="rotate(0deg)")}}handleResize(){if(window.innerWidth<=991&&!this.elements.summaryContent.classList.contains("collapsed")){if(!this.elements.summaryToggle.classList.contains("initialized")){this.elements.summaryContent.classList.add("collapsed"),this.elements.summaryToggle.classList.add("collapsed");const e=this.elements.summaryToggle.querySelector("span");e&&(e.textContent="Show Details"),this.elements.summaryToggle.classList.add("initialized")}}else window.innerWidth>991&&(this.elements.summaryContent.classList.remove("collapsed"),this.elements.summaryToggle.classList.remove("collapsed"))}isPaypalCurrencySupported(e){return["USD","EUR","GBP","CAD","AUD","JPY"].includes(e)}initializePaymentMethod(e){if(w(e,this.elements.paymentTabs,this.elements.selectedMethodName),this.switchPaymentMethod(e),window.innerWidth<=991){this.elements.summaryContent.classList.add("collapsed"),this.elements.summaryToggle.classList.add("collapsed");const t=this.elements.summaryToggle.querySelector("span");t&&(t.textContent="Show Details")}}getState(){return{...this.state}}setState(e){this.state={...this.state,...e}}getElements(){return{...this.elements}}getConfig(){return{...this.config}}}document.addEventListener("DOMContentLoaded",function(){if(typeof window.paymentConfig>"u"){console.error("paymentConfig missing. Make sure checkout template injects it.");return}const n=window.paymentConfig,e={cartTotalPrice:n.cartTotalPrice,defaultCurrency:n.defaultCurrency,csrfToken:n.csrfToken,currencySymbols:{USD:"$",EUR:"€",GBP:"£",KES:"KSh",UGX:"USh",TZS:"TSh"},orderId:n.orderId,paypalClientId:n.paypalClientId,urls:n.urls};window.paymentSystem=new G(e)});
