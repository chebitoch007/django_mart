class u{static updateQueryStringParameter(e,n,o){const i=new URL(e,window.location.origin);return i.searchParams.set(n,o),i.toString()}static removeQueryStringParameter(e,n){const o=new URL(e,window.location.origin);return o.searchParams.delete(n),o.toString()}static getQueryStringParameter(e,n){return new URL(e,window.location.origin).searchParams.get(n)}static buildQueryString(e){const n=new URLSearchParams;return Object.entries(e).forEach(([o,i])=>{i!=null&&i!==""&&n.append(o,String(i))}),n.toString()}static debounce(e,n,o=!1){let i;return(...s)=>{const r=()=>{i=void 0,o||e.apply(this,s)},c=o&&!i;clearTimeout(i),i=window.setTimeout(r,n),c&&e.apply(this,s)}}static throttle(e,n){let o;return(...i)=>{o||(e.apply(this,i),o=!0,setTimeout(()=>o=!1,n))}}static formatPrice(e,n="KES"){return new Intl.NumberFormat("en-KE",{style:"currency",currency:n,minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}static formatNumber(e){return new Intl.NumberFormat("en-KE").format(e)}static formatDate(e,n={}){const o={year:"numeric",month:"short",day:"numeric",...n};return new Intl.DateTimeFormat("en-KE",o).format(new Date(e))}static setStorage(e,n,o){try{const i={value:n,timestamp:o?Date.now()+o*60*1e3:null};localStorage.setItem(e,JSON.stringify(i))}catch(i){console.warn("Local storage not available:",i)}}static getStorage(e){try{const n=localStorage.getItem(e);if(!n)return null;const o=JSON.parse(n);return o.timestamp&&Date.now()>o.timestamp?(localStorage.removeItem(e),null):o.value}catch(n){return console.warn("Error reading from storage:",n),null}}static removeStorage(e){try{localStorage.removeItem(e)}catch(n){console.warn("Error removing from storage:",n)}}static getCSRFToken(){const e=document.querySelector("[name=csrfmiddlewaretoken]");return e?e.value:""}static async apiRequest(e,n={}){const o={headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken(),...n.headers}};try{const i=await fetch(e,{...o,...n}),s=await i.json();if(!i.ok)throw new Error(s.error||"Request failed");return s}catch(i){return console.error("API request failed:",i),{success:!1,error:i instanceof Error?i.message:"Unknown error occurred"}}}static createElement(e,n={},o=[]){const i=document.createElement(e);return Object.entries(n).forEach(([s,r])=>{s==="className"?i.className=r:i.setAttribute(s,r)}),o.forEach(s=>{typeof s=="string"?i.appendChild(document.createTextNode(s)):i.appendChild(s)}),i}static animateElement(e,n,o=300){return new Promise(i=>{e.style.animation=`${n} ${o}ms`,setTimeout(()=>{e.style.animation="",i()},o)})}static validateEmail(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}static validatePhone(e){return/^\+?[\d\s-()]{10,}$/.test(e)}static measurePerformance(e,n){const o=performance.now(),i=e(),s=performance.now();return console.log(`${n} took ${s-o}ms`),i}}class p{static instance;cartCountElements;cartLink;wishlist=new Set;static lastNotificationTime=0;static notificationDebounceMs=300;static isNotifying=!1;constructor(){this.cartCountElements=document.querySelectorAll(".cart-count, #cart-count, #mobile-cart-count"),this.cartLink=document.getElementById("cart-link"),this.loadWishlist(),this.bindEvents(),console.log("üõí CartManager initialized")}static getInstance(){return p.instance||(p.instance=new p),p.instance}bindEvents(){const e=this._cartUpdateListener;e&&(document.body.removeEventListener("htmx:afterRequest",e),console.log("üßπ Removed existing HTMX listener"));const n=this.handleCartUpdate.bind(this);this._cartUpdateListener=n,document.body.addEventListener("htmx:afterRequest",n),console.log("‚úÖ Cart HTMX listener registered"),document.addEventListener("wishlist:toggle",(o=>{this.toggleWishlist(o.detail.product)}))}handleCartUpdate(e){const n=e;if(n.target.closest(".add-to-cart-form")&&n.detail&&n.detail.xhr.status===200){console.log("üîî Cart update detected");try{const s=JSON.parse(n.detail.xhr.responseText);s.success?(this.updateCartCount(s.cart_total_items),this.showDebouncedNotification(s.message,"success"),this.dispatchCartEvent("add",s.cart_item)):s.message==="Product is already in your cart"?this.showDebouncedNotification(s.message,"warning"):this.showDebouncedNotification(s.message,"error")}catch(s){console.error("Error parsing cart response:",s,n.detail.xhr.responseText),this.showDebouncedNotification("An error occurred while updating cart.","error")}}}showDebouncedNotification(e,n){const o=Date.now();if(console.log("üì¨ Notification requested:",{message:e,type:n,timeSinceLastNotification:o-p.lastNotificationTime,isCurrentlyNotifying:p.isNotifying,willShow:!p.isNotifying&&o-p.lastNotificationTime>=p.notificationDebounceMs}),p.isNotifying){console.log("‚è≠Ô∏è  Notification skipped: Already showing a notification");return}if(o-p.lastNotificationTime<p.notificationDebounceMs){console.log("‚è≠Ô∏è  Notification debounced:",e);return}p.isNotifying=!0,p.lastNotificationTime=o,showNotification(e,n),console.log("‚úÖ Notification shown:",e),setTimeout(()=>{p.isNotifying=!1,console.log("üîì Notification system unlocked")},100)}updateCartCount(e){this.cartCountElements.forEach(n=>{n.textContent=e.toString(),n.classList.add("pulse"),setTimeout(()=>n.classList.remove("pulse"),300)}),this.cartLink&&(this.cartLink.style.transform="scale(1.2)",setTimeout(()=>{this.cartLink&&(this.cartLink.style.transform="scale(1)")},300))}toggleWishlist(e){this.wishlist.has(e.id)?(this.wishlist.delete(e.id),this.showDebouncedNotification("Removed from wishlist","info")):(this.wishlist.add(e.id),this.showDebouncedNotification("Added to wishlist","success")),this.saveWishlist(),this.updateWishlistUI(),document.dispatchEvent(new CustomEvent("wishlist:updated",{detail:{product:e,action:this.wishlist.has(e.id)?"add":"remove"}}))}isInWishlist(e){return this.wishlist.has(e)}loadWishlist(){const e=u.getStorage("wishlist");e&&(this.wishlist=new Set(e))}saveWishlist(){u.setStorage("wishlist",Array.from(this.wishlist))}updateWishlistUI(){document.querySelectorAll(".wishlist-btn").forEach(e=>{const n=parseInt(e.getAttribute("data-product-id")||"0");this.wishlist.has(n)?(e.classList.add("active"),e.innerHTML='<i class="fas fa-heart"></i>'):(e.classList.remove("active"),e.innerHTML='<i class="far fa-heart"></i>')})}dispatchCartEvent(e,n){const o=new CustomEvent("analytics:cart",{detail:{type:"cart_interaction",data:{action:e,item:n,timestamp:Date.now()}}});document.dispatchEvent(o)}quickAdd(e,n=1){const o=new FormData;o.append("product_id",e.toString()),o.append("quantity",n.toString()),o.append("csrfmiddlewaretoken",u.getCSRFToken()),fetch("/cart/add/",{method:"POST",body:o,headers:{"X-Requested-With":"XMLHttpRequest"}}).then(i=>i.json()).then(i=>{i.success?(this.updateCartCount(i.cart_total_items),this.showDebouncedNotification(i.message,"success")):this.showDebouncedNotification(i.message,"error")}).catch(i=>{console.error("Quick add failed:",i),this.showDebouncedNotification("Failed to add item to cart","error")})}}const R=p.getInstance();console.log("‚úÖ base.ts loaded - CartManager singleton created");function S(){document.getElementById("filterToggle"),document.getElementById("filterContent");const t=document.getElementById("priceRange"),e=document.getElementById("priceDisplay");function n(){const o=document.getElementById("filterToggle"),i=document.getElementById("filterContent");if(!o||!i)return;const s=1024;function r(){window.innerWidth>=s?(i.removeAttribute("hidden"),i.classList.remove("slide-in"),o.style.display="none"):((!o.hasAttribute("aria-expanded")||o.getAttribute("aria-expanded")==="false")&&i.setAttribute("hidden",""),o.style.display="flex")}r(),window.addEventListener("resize",u.debounce(r,150)),o.addEventListener("click",()=>{const c=i.hasAttribute("hidden");c?(i.removeAttribute("hidden"),i.classList.add("slide-in"),o.setAttribute("aria-expanded","true"),document.body.classList.add("no-scroll")):(i.classList.remove("slide-in"),setTimeout(()=>i.setAttribute("hidden",""),250),o.setAttribute("aria-expanded","false"),document.body.classList.remove("no-scroll"));const a=o.querySelector("span");a&&(a.textContent=c?"Hide Filters":"Show Filters")})}n(),t&&e&&t.addEventListener("input",()=>{e.textContent=`${t.value} KES`}),D(),J()}function D(){document.querySelectorAll(".product-card").forEach(e=>{e.addEventListener("mouseenter",()=>{e.classList.add("hover"),j(e)}),e.addEventListener("mouseleave",()=>{e.classList.remove("hover")}),Q(e)}),Z()}function j(t){const e=t.getAttribute("data-hover-image");if(e&&!t.classList.contains("image-preloaded")){const n=new Image;n.src=e,n.onload=()=>{t.classList.add("image-preloaded")}}}function Q(t){const e=t.querySelectorAll("img[data-src]"),n=new IntersectionObserver(o=>{o.forEach(i=>{if(i.isIntersecting){const s=i.target,r=s.getAttribute("data-src");r&&(s.src=r,s.removeAttribute("data-src"),n.unobserve(s),s.addEventListener("load",()=>{s.classList.add("loaded")}))}})},{rootMargin:"50px 0px",threshold:.01});e.forEach(o=>n.observe(o))}function _(){document.addEventListener("click",t=>{const e=t.target.closest(".quick-view-btn");if(e){t.preventDefault();const n=e.getAttribute("data-product-id");n&&$(n)}}),document.addEventListener("click",t=>{const e=document.getElementById("quick-view-modal");e&&(t.target===e||t.target.closest(".close-quick-view"))&&q()}),document.addEventListener("keydown",t=>{const e=document.getElementById("quick-view-modal");e&&!e.classList.contains("hidden")&&(t.key==="Escape"?q():t.key==="ArrowLeft"?b("prev"):t.key==="ArrowRight"&&b("next"))})}function $(t){const e=document.getElementById("quick-view-modal");e&&(e.classList.remove("hidden"),e.innerHTML=`
      <div class="quick-view-loading">
        <i class="fas fa-spinner fa-spin fa-2x"></i>
        <p>Loading product details...</p>
      </div>
    `,fetch(`/api/products/${t}/quick-view/`).then(n=>n.json()).then(n=>{n.success?X(n.product):C()}).catch(n=>{console.error("Quick view failed:",n),C()})),document.body.style.overflow="hidden"}function X(t){const e=document.getElementById("quick-view-modal");e&&(e.innerHTML=`
    <div class="quick-view-content">
      <button class="close-quick-view" aria-label="Close quick view">
        <i class="fas fa-times"></i>
      </button>
      
      <div class="quick-view-nav">
        <button class="nav-btn prev-btn" aria-label="Previous product">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button class="nav-btn next-btn" aria-label="Next product">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>

      <div class="quick-view-body">
        <div class="quick-view-images">
          <img src="${t.image_url}" alt="${t.name}" class="main-image">
          <div class="image-thumbnails">
            ${t.images?.map((n,o)=>`
              <img src="${n}" alt="Thumbnail ${o+1}" class="thumbnail ${o===0?"active":""}">
            `).join("")||""}
          </div>
        </div>

        <div class="quick-view-details">
          <h2 class="product-title">${t.name}</h2>
          <div class="price">${u.formatPrice(t.price)}</div>
          <div class="rating">${ee(t.rating)}</div>
          <div class="stock-status">${t.stock>0?"In Stock":"Out of Stock"}</div>
          <p class="description">${t.short_description}</p>

          <div class="quick-actions">
            <button class="btn-primary add-to-cart-quick" 
                    ${t.stock<=0?"disabled":""}
                    data-product-id="${t.id}">
              <i class="fas fa-shopping-cart"></i>
              Add to Cart
            </button>
            <button class="btn-secondary wishlist-btn" data-product-id="${t.id}">
              <i class="far fa-heart"></i>
            </button>
            <button class="btn-secondary compare-btn" data-product-id="${t.id}">
              <i class="fas fa-balance-scale"></i>
            </button>
          </div>

          <div class="product-meta">
            <div class="meta-item">
              <i class="fas fa-shipping-fast"></i>
              Free shipping
            </div>
            <div class="meta-item">
              <i class="fas fa-undo"></i>
              30-day returns
            </div>
            <div class="meta-item">
              <i class="fas fa-shield-alt"></i>
              2-year warranty
            </div>
          </div>
        </div>
      </div>
    </div>
  `,W())}function W(){document.querySelector(".add-to-cart-quick")?.addEventListener("click",t=>{const e=t.target,n=e.getAttribute("data-product-id");n&&(R.quickAdd(parseInt(n),1),e.innerHTML='<i class="fas fa-check"></i> Added to Cart',e.disabled=!0,setTimeout(()=>{e.innerHTML='<i class="fas fa-shopping-cart"></i> Add to Cart',e.disabled=!1},2e3))}),document.querySelector(".wishlist-btn")?.addEventListener("click",t=>{const e=t.target,n=e.getAttribute("data-product-id");if(n){const o=e.classList.contains("active");e.classList.toggle("active"),e.innerHTML=o?'<i class="far fa-heart"></i>':'<i class="fas fa-heart" style="color: #ef4444;"></i>',document.dispatchEvent(new CustomEvent("wishlist:toggle",{detail:{product:{id:parseInt(n)},action:o?"remove":"add"}}))}}),document.querySelectorAll(".thumbnail").forEach(t=>{t.addEventListener("click",()=>{const e=document.querySelector(".quick-view-images .main-image");e&&t instanceof HTMLImageElement&&(e.src=t.src,document.querySelectorAll(".thumbnail").forEach(n=>n.classList.remove("active")),t.classList.add("active"))})}),document.querySelector(".prev-btn")?.addEventListener("click",()=>b("prev")),document.querySelector(".next-btn")?.addEventListener("click",()=>b("next"))}function b(t){const e=document.querySelector(".add-to-cart-quick")?.getAttribute("data-product-id"),n=Array.from(document.querySelectorAll(".product-card")),o=n.findIndex(r=>r.getAttribute("data-product-id")===e);let i;t==="prev"?i=o>0?o-1:n.length-1:i=o<n.length-1?o+1:0;const s=n[i]?.getAttribute("data-product-id");s&&$(s)}function q(){const t=document.getElementById("quick-view-modal");t&&t.classList.add("hidden"),document.body.style.overflow=""}function C(){const t=document.getElementById("quick-view-modal");t&&(t.innerHTML=`
      <div class="quick-view-error">
        <i class="fas fa-exclamation-triangle fa-2x"></i>
        <h3>Unable to load product</h3>
        <p>Please try again later.</p>
        <button class="btn-primary close-quick-view">Close</button>
      </div>
    `)}function K(){const t=document.querySelectorAll(".compare-checkbox"),e=document.getElementById("compare-bar");let n=[];t.forEach(i=>{i.addEventListener("change",()=>{const s=parseInt(i.value);i.checked?n.push(s):n=n.filter(r=>r!==s),o(n)})});function o(i){if(e)if(i.length>0){e.classList.remove("hidden");const s=e.querySelector(".compare-count");s&&(s.textContent=i.length.toString());const r=e.querySelector(".compare-btn");r&&(r.disabled=i.length<2)}else e.classList.add("hidden")}document.querySelector(".compare-btn")?.addEventListener("click",()=>{const i=n.join(",");window.open(`/compare/?products=${i}`,"_blank")})}function Y(){if(!document.body.classList.contains("infinite-scroll"))return;const t=new IntersectionObserver(n=>{n.forEach(o=>{o.isIntersecting&&N()})},{rootMargin:"100px 0px",threshold:.1}),e=document.getElementById("load-more-sentinel");e&&t.observe(e)}function N(){const t=document.getElementById("load-more-btn"),e=parseInt(t?.getAttribute("data-page")||"1"),n=parseInt(t?.getAttribute("data-total-pages")||"1");if(e>=n)return;t instanceof HTMLButtonElement&&(t.disabled=!0);const o=e+1,i=new URL(window.location.href);i.searchParams.set("page",o.toString()),fetch(i.toString()).then(s=>s.text()).then(s=>{const a=new DOMParser().parseFromString(s,"text/html").querySelector(".product-grid")?.innerHTML;if(a){const l=document.querySelector(".product-grid");l&&(l.innerHTML+=a),t instanceof HTMLButtonElement&&(t.setAttribute("data-page",o.toString()),o>=n?t.style.display="none":(t.innerHTML="Load More Products",t.disabled=!1)),D()}}).catch(s=>{console.error("Failed to load more products:",s),t instanceof HTMLButtonElement&&(t.innerHTML="Error loading products",setTimeout(()=>{t.innerHTML="Load More Products",t.disabled=!1},3e3))})}function J(){const t=document.querySelectorAll(".product-card"),e=new IntersectionObserver(n=>{n.forEach(o=>{if(o.isIntersecting){const i=o.target,s=i.getAttribute("data-product-id");s&&!i.classList.contains("view-tracked")&&(i.classList.add("view-tracked"),document.dispatchEvent(new CustomEvent("analytics:productView",{detail:{productId:parseInt(s),list:G(),position:Array.from(t).indexOf(i)+1}})))}})},{threshold:.5});t.forEach(n=>e.observe(n))}function G(){return document.body.classList.contains("search-page")?"search":document.body.classList.contains("category-page")?"category":window.location.pathname.includes("/deals/")?"deals":"general"}function Z(){const t=document.querySelector(".product-count");t&&u.animateElement(t,"bounceIn",500)}function ee(t){const e=Math.floor(t),n=t%1>=.5,o=5-e-(n?1:0);return`
    ${'<i class="fas fa-star"></i>'.repeat(e)}
    ${n?'<i class="fas fa-star-half-alt"></i>':""}
    ${'<i class="far fa-star"></i>'.repeat(o)}
  `}const M=Object.freeze(Object.defineProperty({__proto__:null,initComparison:K,initInfiniteScroll:Y,initProductList:S,initQuickView:_,loadMoreProducts:N},Symbol.toStringTag,{value:"Module"}));function k(){const t=document.querySelector("[name=csrfmiddlewaretoken]");return t?t.value:""}function y(t,e){const n=document.createElement("div");n.className=`toast ${e}`;const o=document.createElement("i");o.className=e==="success"?"fas fa-check-circle":"fas fa-exclamation-circle",n.appendChild(o),n.appendChild(document.createTextNode(t)),document.body.appendChild(n),setTimeout(()=>{n.style.animation="slideOutDown 0.3s ease forwards",n.addEventListener("animationend",()=>n.remove())},2700)}function te(){const t=document.getElementById("main-product-image"),e=document.querySelectorAll(".thumbnail-item"),n=document.getElementById("image-zoom-container"),o=document.getElementById("fullscreen-btn");if(!t||!n)return;e.forEach(l=>{const d=l.querySelector(".thumbnail-image");d&&l.addEventListener("click",f=>{f.preventDefault();const g=d.dataset.src||d.src,m=d.dataset.largeSrc||g;t.style.opacity="0",setTimeout(()=>{t.src=g,t.dataset.largeSrc=m,n.style.backgroundImage=`url(${m})`,t.style.opacity="1"},200),e.forEach(v=>v.classList.remove("active")),l.classList.add("active")})});const i=t.parentElement;i&&(i.addEventListener("mousemove",l=>{const{left:d,top:f,width:g,height:m}=i.getBoundingClientRect(),v=(l.clientX-d)/g*100,h=(l.clientY-f)/m*100;n.style.backgroundPosition=`${v}% ${h}%`}),i.addEventListener("mouseenter",()=>{n.classList.add("active")}),i.addEventListener("mouseleave",()=>{n.classList.remove("active")})),o?.addEventListener("click",()=>{const l=ne(t.dataset.largeSrc||t.src);document.body.appendChild(l)});let s=0,r=0;t.addEventListener("touchstart",l=>{s=l.changedTouches[0].screenX}),t.addEventListener("touchend",l=>{r=l.changedTouches[0].screenX,c()});function c(){r<s-50?a(1):r>s+50&&a(-1)}function a(l){const f=(Array.from(e).findIndex(g=>g.classList.contains("active"))+l+e.length)%e.length;e[f].click()}t.style.transition="opacity 0.3s ease"}function ne(t){const e=document.createElement("div");e.className="image-lightbox",e.style.cssText=`
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    cursor: zoom-out;
    animation: fadeIn 0.3s ease;
  `;const n=document.createElement("img");n.src=t,n.style.cssText=`
    max-width: 90%;
    max-height: 90%;
    object-fit: contain;
    animation: zoomIn 0.3s ease;
  `;const o=document.createElement("button");o.innerHTML='<i class="fas fa-times"></i>',o.style.cssText=`
    position: absolute;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.9);
    border: none;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    font-size: 1.5rem;
    cursor: pointer;
    color: #1e293b;
    transition: all 0.3s ease;
  `,o.addEventListener("mouseover",()=>{o.style.background="#ffffff",o.style.transform="rotate(90deg) scale(1.1)"}),o.addEventListener("mouseout",()=>{o.style.transform="rotate(0) scale(1)"});const i=()=>{e.style.animation="fadeOut 0.3s ease",setTimeout(()=>e.remove(),300)};o.addEventListener("click",i),e.addEventListener("click",c=>{c.target===e&&i()});const s=c=>{c.key==="Escape"&&(i(),document.removeEventListener("keydown",s))};document.addEventListener("keydown",s),e.appendChild(n),e.appendChild(o);const r=document.createElement("style");return r.textContent=`
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    @keyframes zoomIn {
      from { transform: scale(0.8); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
  `,document.head.appendChild(r),e}function oe(){const t=document.querySelector(".rating-input");if(!t)return;const e=t.querySelectorAll("label"),n=t.querySelectorAll('input[type="radio"]');e.forEach((o,i)=>{o.addEventListener("click",()=>{n[i].checked=!0}),o.addEventListener("mouseenter",()=>{const s=5-i;e.forEach((r,c)=>{5-c<=s?r.style.color="#fbbf24":r.style.color="#cbd5e1"})}),o.addEventListener("mouseleave",()=>{e.forEach((s,r)=>{const c=n[r].checked;s.style.color=c?"#f59e0b":"#cbd5e1"})})})}function ie(){const t=document.querySelector(".quantity-input"),e=document.querySelector(".quantity-minus"),n=document.querySelector(".quantity-plus");if(console.log("[Quantity] initQuantityControls() called"),!t){console.warn("[Quantity] ‚ùå Quantity input not found");return}let o=parseInt(t.dataset.maxStock||"99");new MutationObserver(s=>{s.forEach(r=>{r.type==="attributes"&&r.attributeName==="data-max-stock"&&(o=parseInt(t.dataset.maxStock||"99"),t.max=o.toString())})}).observe(t,{attributes:!0}),e?.addEventListener("click",s=>{s.stopPropagation();const r=parseInt(t.value)||1;r>1&&(t.value=(r-1).toString(),A(e))}),n?.addEventListener("click",s=>{s.stopPropagation();const r=parseInt(t.value)||1;r<o&&(t.value=(r+1).toString(),A(n))}),t.addEventListener("input",()=>{let s=parseInt(t.value)||1;s<1&&(s=1),s>o&&(s=o),t.value=s.toString()}),t.addEventListener("keydown",s=>{s.key==="ArrowUp"?(s.preventDefault(),n?.click()):s.key==="ArrowDown"&&(s.preventDefault(),e?.click())})}function A(t){t.style.transform="scale(0.9)",setTimeout(()=>{t.style.transform="scale(1)"},150)}function se(){const t=document.querySelector("[data-product-variants]");if(!t)return;const e=JSON.parse(t.dataset.productVariants||"[]");if(e.length===0)return;const n=document.querySelectorAll(".color-pill"),o=document.querySelectorAll(".size-pill"),i=document.getElementById("product-price"),s=document.getElementById("product-original-price"),r=document.getElementById("product-stock-status"),c=document.querySelector('input[name="variant_id"]'),a=document.getElementById("selected-color"),l=document.getElementById("selected-size"),d=document.getElementById("add-to-cart-button"),f=document.querySelector(".quantity-input");n.forEach(m=>{m.addEventListener("click",function(){n.forEach(v=>v.classList.remove("active")),this.classList.add("active"),a&&(a.value=this.dataset.color||""),g()})}),o.forEach(m=>{m.addEventListener("click",function(){o.forEach(v=>v.classList.remove("active")),this.classList.add("active"),l&&(l.value=this.dataset.size||""),g()})});function g(){const m=a?.value||null,v=l?.value||null,h=e.find(E=>{const U=!E.color||E.color===m||!m,z=!E.size||E.size===v||!v;return U&&z});h&&i&&r&&c&&d&&f&&(i.style.opacity="0.5",setTimeout(()=>{i.textContent=`KES ${h.price.toLocaleString()}`,i.style.opacity="1"},150),s&&(s.style.display="none"),h.quantity>10?r.innerHTML='<span class="stock-in"><i class="fas fa-check-circle"></i> In Stock</span>':h.quantity>0?r.innerHTML=`<span class="stock-low"><i class="fas fa-exclamation-circle"></i> Only ${h.quantity} left!</span>`:r.innerHTML='<span class="stock-out"><i class="fas fa-times-circle"></i> Out of Stock</span>',c.value=h.id.toString(),d.disabled=h.quantity<=0,f.max=h.quantity.toString(),f.dataset.maxStock=h.quantity.toString(),parseInt(f.value)>h.quantity&&(f.value=h.quantity>0?h.quantity.toString():"1"))}}function re(){const t=document.getElementById("toggle-review-form"),e=document.getElementById("review-form");!t||!e||t.addEventListener("click",n=>{n.preventDefault();const o=e.classList.toggle("active");t.innerHTML=o?'<i class="fas fa-times"></i> Cancel':'<i class="fas fa-edit"></i> Write a Review',o&&setTimeout(()=>{e.scrollIntoView({behavior:"smooth",block:"start"})},400)})}function ae(){const t=document.getElementById("review-filter"),e=document.getElementById("review-sort"),n=document.querySelector(".reviews-list");if(!n)return;function o(){const i=t?.value??"all",s=e?.value??"newest",r=Array.from(n.querySelectorAll(".review-item"));r.forEach(a=>{const l=a.dataset.rating??"",d=i==="all"||l===i;a.style.display=d?"block":"none",d?a.style.animation="fadeIn 0.3s ease":a.style.animation=""});const c=r.filter(a=>a.style.display!=="none");c.sort((a,l)=>{const d=new Date(a.dataset.date??"").getTime(),f=new Date(l.dataset.date??"").getTime(),g=parseInt(a.dataset.rating??"0",10),m=parseInt(l.dataset.rating??"0",10),v=parseInt(a.dataset.helpful??"0",10),h=parseInt(l.dataset.helpful??"0",10);switch(s){case"newest":return f-d;case"oldest":return d-f;case"highest":return m-g;case"lowest":return g-m;case"most_helpful":return h-v;default:return 0}}),c.forEach(a=>n.appendChild(a))}t?.addEventListener("change",o),e?.addEventListener("change",o),o(),ce(),le()}function ce(){document.querySelectorAll(".helpful-btn").forEach(e=>{const n=e.dataset.reviewId,o=e.dataset.url;if(!n||!o)return;e.dataset.voted==="true"&&e.classList.add("voted"),e.addEventListener("click",async s=>{if(s.preventDefault(),e.dataset.busy==="true")return;e.dataset.busy="true",e.disabled=!0;const r=e.querySelector(".helpful-count"),c=e.closest(".review-item");try{const a=await fetch(o,{method:"POST",headers:{"X-CSRFToken":k(),"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"});if(a.status===401||a.status===403){y("You need to log in to vote helpful reviews.","error");return}if(!a.ok){y("Could not register vote. Please try again.","error");return}const l=await a.json();if(l.success){const d=typeof l.new_count<"u"?parseInt(l.new_count,10):null;d!==null&&r&&(r.textContent=`(${d})`),c&&d!==null&&(c.dataset.helpful=String(d)),l.voted?(e.classList.add("voted"),e.dataset.voted="true",y("Marked as helpful","success")):l.unvoted&&(e.classList.remove("voted"),e.dataset.voted="false",y("Removed helpful vote","success")),e.style.transform="scale(1.05)",setTimeout(()=>e.style.transform="scale(1)",180)}else y(l.message||"Unable to vote","error")}catch(a){console.error("Helpful vote error",a),y("An error occurred. Please try again.","error")}finally{e.disabled=!1,e.dataset.busy="false"}})})}function le(){document.querySelectorAll(".delete-review-btn").forEach(t=>{const e=t.dataset.reviewId;e&&t.addEventListener("click",async n=>{if(n.preventDefault(),!!confirm("Delete your review? This cannot be undone.")){t.disabled=!0;try{const i=await fetch(`/reviews/${e}/delete/`,{method:"POST",headers:{"X-CSRFToken":k(),"X-Requested-With":"XMLHttpRequest",Accept:"application/json"},credentials:"same-origin"});if(!i.ok){y("Could not delete review. Please try again.","error");return}const s=await i.json();if(s.success){const r=t.closest(".review-item");r&&r.remove(),y("Review deleted","success")}else y(s.message||"Unable to delete review","error")}catch(i){console.error("Delete review error",i),y("Network error. Try again later.","error")}finally{t.disabled=!1}}})})}function de(){const t=document.querySelector(".notify-btn");t?.addEventListener("click",async()=>{const e=t.dataset.productId,n=prompt("Enter your email to be notified when this product is back in stock:");if(!n)return;if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)){y("Please enter a valid email address.","error");return}try{const s=await(await fetch("/notifications/stock/",{method:"POST",headers:{"X-CSRFToken":k(),"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({product_id:e,email:n})})).json();s.success?(y(s.message||"You will be notified when this item is back in stock!","success"),t.disabled=!0,t.style.opacity="0.6"):y(s.message||"Unable to register notification.","error")}catch{y("An error occurred. Please try again later.","error")}})}function ue(){document.querySelectorAll(".share-btn").forEach(e=>{e.addEventListener("click",n=>{n.preventDefault();const o=e.dataset.platform,i=encodeURIComponent(window.location.href),s=encodeURIComponent(document.title);let r="";switch(o){case"facebook":r=`https://www.facebook.com/sharer/sharer.php?u=${i}`;break;case"twitter":r=`https://twitter.com/intent/tweet?url=${i}&text=${s}`;break;case"whatsapp":r=`https://wa.me/?text=${s}%20${i}`;break;case"pinterest":const c=document.getElementById("main-product-image")?.src||"";r=`https://pinterest.com/pin/create/button/?url=${i}&media=${encodeURIComponent(c)}&description=${s}`;break;case"copy":navigator.clipboard.writeText(window.location.href).then(()=>{y("Link copied to clipboard!","success")});return}r&&window.open(r,"_blank","width=600,height=400")})})}function me(){const t=document.getElementById("question-form"),e=document.getElementById("toggle-question-form");e&&t&&e.addEventListener("click",()=>{t.classList.toggle("active"),t.classList.contains("active")?(e.textContent="Cancel",t.scrollIntoView({behavior:"smooth",block:"nearest"})):e.textContent="Ask a Question"})}function fe(){const t=document.querySelectorAll("img[data-src]");if("IntersectionObserver"in window){const e=new IntersectionObserver((n,o)=>{n.forEach(i=>{if(i.isIntersecting){const s=i.target;s.src=s.dataset.src||"",s.classList.add("loaded"),o.unobserve(s)}})});t.forEach(n=>e.observe(n))}else t.forEach(e=>{const n=e;n.src=n.dataset.src||""})}function ge(){const t=document.querySelector(".mobile-sticky-cta"),e=document.querySelector(".add-to-cart-form");if(!t||!e)return;new IntersectionObserver(o=>{o.forEach(i=>{i.isIntersecting?t.style.transform="translateY(100%)":t.style.transform="translateY(0)"})},{threshold:.1}).observe(e),t.style.transition="transform 0.3s ease"}function he(){const t=document.querySelectorAll(".review-item, .product-info-card"),e=new IntersectionObserver(o=>{o.forEach(i=>{i.isIntersecting&&i.target.classList.add("fade-in-up")})},{threshold:.1});t.forEach(o=>e.observe(o));const n=document.createElement("style");n.textContent=`
    .fade-in-up {
      animation: fadeInUp 0.6s ease forwards;
    }
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  `,document.head.appendChild(n)}console.log("[Init] initProductDetail() called");let x=!1;function L(){if(x){console.warn("[Init] Product detail already initialized ‚Äì skipping duplicate");return}x=!0,console.log("[Init] Product detail initialized once"),te(),ie(),se(),oe(),ae(),re(),de(),ue(),me(),fe(),ge(),he(),console.log("‚úÖ Product detail page initialized (without duplicate notifications)")}typeof window<"u"&&(document.readyState==="loading"?document.addEventListener("DOMContentLoaded",L):L());const pe="modulepreload",ye=function(t){return"/static/frontend/"+t},T={},H=function(e,n,o){let i=Promise.resolve();if(n&&n.length>0){let l=function(d){return Promise.all(d.map(f=>Promise.resolve(f).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};var r=l;document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),a=c?.nonce||c?.getAttribute("nonce");i=l(n.map(d=>{if(d=ye(d),d in T)return;T[d]=!0;const f=d.endsWith(".css"),g=f?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${g}`))return;const m=document.createElement("link");if(m.rel=f?"stylesheet":pe,f||(m.as="script"),m.crossOrigin="",m.href=d,a&&m.setAttribute("nonce",a),document.head.appendChild(m),f)return new Promise((v,h)=>{m.addEventListener("load",v),m.addEventListener("error",()=>h(new Error(`Unable to preload CSS for ${d}`)))})}))}function s(c){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=c,window.dispatchEvent(a),!a.defaultPrevented)throw c}return i.then(c=>{for(const a of c||[])a.status==="rejected"&&s(a.reason);return e().catch(s)})};function ve(){console.log("Initializing enhanced search..."),we(),Se(),I(),Ce(),Ae(),Be(),De(),$e(),Ne(),Me()}function we(){document.getElementById("filterToggle"),document.getElementById("filterContent");const t=document.getElementById("priceRange"),e=document.getElementById("maxPriceInput"),n=document.getElementById("priceDisplay"),o=document.getElementById("applyPriceBtn"),i=document.getElementById("inStock"),s=document.getElementById("sortSelect");t&&n&&t.addEventListener("input",u.debounce(()=>{const r=t.value;n.textContent=u.formatPrice(parseInt(r)),e&&(e.value=r),w("max_price",r)},500)),e&&t&&n&&e.addEventListener("input",u.debounce(()=>{let r=parseInt(e.value);isNaN(r)&&(r=0),r>1e4&&(r=1e4),r<0&&(r=0),e.value=r.toString(),t.value=r.toString(),n.textContent=u.formatPrice(r)},500)),o&&e&&o.addEventListener("click",()=>{const r=e.value||"10000";w("max_price",r)}),i&&i.addEventListener("change",u.debounce(()=>{const r=i.checked?"true":"";w("in_stock",r)},300)),s&&s.addEventListener("change",u.debounce(()=>{w("sort",s.value)},300)),Ee()}function Ee(){document.querySelectorAll(".category-filter").forEach(e=>{e.addEventListener("click",n=>{n.preventDefault();const o=e.getAttribute("data-category");o&&w("category",o)})})}function w(t,e){const n=new URL(window.location.href);e?n.searchParams.set(t,e):n.searchParams.delete(t),window.history&&window.history.replaceState&&window.history.replaceState({},"",n.toString()),be()}function be(){const t=document.getElementById("search-results"),e=document.getElementById("search-loading");if(t&&e){t.classList.add("loading"),e.classList.remove("hidden");const n=new URL(window.location.href);n.searchParams.set("ajax","true"),fetch(n.toString()).then(o=>o.text()).then(o=>{const r=new DOMParser().parseFromString(o,"text/html").getElementById("search-results");r&&(t.innerHTML=r.innerHTML,I())}).catch(o=>{console.error("Failed to reload search results:",o),Ve()}).finally(()=>{t.classList.remove("loading"),e.classList.add("hidden")})}}function Se(){const t=document.querySelector('input[name="q"]'),e=document.getElementById("search-suggestions");if(!t||!e)return;let n=null;t.addEventListener("input",u.debounce(async()=>{const o=t.value.trim();if(n&&n.abort(),o.length<2){e.classList.add("hidden");return}e.innerHTML='<div class="suggestion-loading"><i class="fas fa-spinner fa-spin"></i> Searching...</div>',e.classList.remove("hidden"),n=new AbortController;try{const s=await(await fetch(`/api/search/suggestions?q=${encodeURIComponent(o)}`,{signal:n.signal})).json();Le(s,o)}catch(i){i.name!=="AbortError"&&(console.error("Failed to fetch search suggestions:",i),e.classList.add("hidden"))}},300)),t.addEventListener("keydown",o=>{if(!e.classList.contains("hidden")){const i=e.querySelectorAll(".suggestion-item"),s=e.querySelector(".suggestion-item.focused");let r=Array.from(i).indexOf(s);switch(o.key){case"ArrowDown":o.preventDefault(),r=(r+1)%i.length;break;case"ArrowUp":o.preventDefault(),r=r<=0?i.length-1:r-1;break;case"Enter":o.preventDefault(),s&&s.click();return;case"Escape":e.classList.add("hidden");return}i.forEach(c=>c.classList.remove("focused")),i[r]&&i[r].classList.add("focused")}}),document.addEventListener("click",o=>{!e.contains(o.target)&&o.target!==t&&e.classList.add("hidden")})}function Le(t,e){const n=document.getElementById("search-suggestions");if(!n)return;if(t.length===0){n.innerHTML=`
      <div class="suggestion-item">
        <i class="fas fa-search"></i>
        <span>No results found for "${e}"</span>
      </div>
    `;return}const o=t.map(i=>`
    <div class="suggestion-item ${i.type}" data-url="${i.url}">
      <div class="suggestion-icon">
        ${ke(i.type)}
      </div>
      <div class="suggestion-content">
        <div class="suggestion-title">${Ie(i.name,e)}</div>
        ${i.category?`<div class="suggestion-category">${i.category}</div>`:""}
        ${i.price?`<div class="suggestion-price">${i.price}</div>`:""}
      </div>
      ${i.type==="search"?'<i class="fas fa-arrow-right suggestion-arrow"></i>':""}
    </div>
  `).join("");n.innerHTML=o,n.querySelectorAll(".suggestion-item").forEach(i=>{i.addEventListener("click",()=>{const s=i.getAttribute("data-url");if(s)window.location.href=s;else{const r=document.querySelector('input[name="q"]'),c=i.querySelector(".suggestion-title")?.textContent;c&&r&&(r.value=c,r.form?.submit())}})}),n.classList.remove("hidden")}function ke(t){switch(t){case"product":return'<i class="fas fa-cube"></i>';case"category":return'<i class="fas fa-folder"></i>';case"trending":return'<i class="fas fa-fire"></i>';case"brand":return'<i class="fas fa-tag"></i>';default:return'<i class="fas fa-search"></i>'}}function Ie(t,e){const n=new RegExp(`(${e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})`,"gi");return t.replace(n,"<mark>$1</mark>")}function I(){const t=document.getElementById("search-results");if(!t)return;t.querySelectorAll(".product-card").forEach(n=>{n.querySelector(".quick-view-btn")?.addEventListener("click",s=>{s.preventDefault(),n.getAttribute("data-product-id")&&H(()=>Promise.resolve().then(()=>M),void 0).then(c=>{c.initQuickView()})});const i=n.querySelector(".wishlist-btn");i?.addEventListener("click",s=>{s.preventDefault();const r=n.getAttribute("data-product-id");r&&document.dispatchEvent(new CustomEvent("wishlist:toggle",{detail:{product:{id:parseInt(r)},action:i.classList.contains("active")?"remove":"add"}}))})}),qe()}function qe(){const t=document.getElementById("search-results"),e=new URLSearchParams(window.location.search).get("q");if(!t||!e)return;const n=new IntersectionObserver(o=>{o.forEach(i=>{if(i.isIntersecting){const s=i.target,r=s.getAttribute("data-product-id"),c=Array.from(t.querySelectorAll(".product-card")).indexOf(s)+1;r&&!s.classList.contains("impression-tracked")&&(s.classList.add("impression-tracked"),document.dispatchEvent(new CustomEvent("analytics:searchImpression",{detail:{query:e,productId:parseInt(r),position:c,page:Oe()}})))}})},{threshold:.5,rootMargin:"100px 0px"});t.querySelectorAll(".product-card").forEach(o=>{n.observe(o)})}function Ce(){const t=new URLSearchParams(window.location.search).get("q");t&&(document.dispatchEvent(new CustomEvent("analytics:searchQuery",{detail:{query:t,resultsCount:F(),filters:Fe()}})),xe(t))}function Ae(){const t=document.querySelector('input[name="q"]'),e=document.getElementById("search-history");if(!t||!e)return;t.addEventListener("focus",()=>{const o=O();o.length>0&&(Te(o),e.classList.remove("hidden"))}),document.getElementById("clear-search-history")?.addEventListener("click",()=>{Pe(),e.classList.add("hidden")})}function O(){return u.getStorage("search-history")||[]}function xe(t){const e=O(),n=[t,...e.filter(o=>o!==t)].slice(0,10);u.setStorage("search-history",n)}function Te(t){const e=document.getElementById("search-history");e&&(e.innerHTML=`
    <div class="search-history-header">
      <h4>Recent Searches</h4>
      <button id="clear-search-history" class="clear-history-btn">
        <i class="fas fa-times"></i> Clear
      </button>
    </div>
    <div class="search-history-items">
      ${t.map(n=>`
        <div class="history-item" data-term="${n}">
          <i class="fas fa-clock"></i>
          <span>${n}</span>
        </div>
      `).join("")}
    </div>
  `,e.querySelectorAll(".history-item").forEach(n=>{n.addEventListener("click",()=>{const o=n.getAttribute("data-term");if(o){const i=document.querySelector('input[name="q"]');i.value=o,i.form?.submit()}})}))}function Pe(){u.removeStorage("search-history")}function Be(){const t=document.getElementById("voice-search-btn");if(!t||!("webkitSpeechRecognition"in window))return;const e=new window.webkitSpeechRecognition;e.continuous=!1,e.interimResults=!1,t.addEventListener("click",()=>{e.start(),t.classList.add("listening")}),e.onresult=n=>{const o=n.results[0][0].transcript,i=document.querySelector('input[name="q"]');i&&(i.value=o,i.form?.submit())},e.onend=()=>{t.classList.remove("listening")},e.onerror=()=>{t.classList.remove("listening"),Re()}}function Re(){const t=u.createElement("div",{className:"toast error"},["Voice search failed. Please try again."]);document.body.appendChild(t),setTimeout(()=>t.remove(),3e3)}function De(){const t=document.querySelectorAll(".search-sort-option");t.forEach(e=>{e.addEventListener("click",n=>{n.preventDefault();const o=e.getAttribute("data-sort");o&&(w("sort",o),t.forEach(i=>i.classList.remove("active")),e.classList.add("active"))})})}function $e(){document.querySelectorAll(".search-pagination a").forEach(e=>{e.addEventListener("click",n=>{n.preventDefault();const o=e.href,i=document.getElementById("search-results");i&&(i.classList.add("loading"),fetch(o).then(s=>s.text()).then(s=>{const a=new DOMParser().parseFromString(s,"text/html").getElementById("search-results");a&&(i.innerHTML=a.innerHTML,I(),i.scrollIntoView({behavior:"smooth"}),window.history.pushState({},"",o))}).catch(s=>{console.error("Pagination failed:",s),window.location.href=o}).finally(()=>{i.classList.remove("loading")}))})})}function Ne(){const t=document.getElementById("spelling-correction");if(t){const e=t.getAttribute("data-corrected-term"),n=t.getAttribute("data-original-term");t.querySelector(".corrected-link")?.addEventListener("click",o=>{if(o.preventDefault(),e){const i=document.querySelector('input[name="q"]');i&&(i.value=e,i.form?.submit())}}),t.querySelector(".original-link")?.addEventListener("click",o=>{if(o.preventDefault(),n){const i=document.querySelector('input[name="q"]');i&&(i.value=n,i.form?.submit())}})}}function Me(){document.querySelectorAll(".facet-toggle").forEach(e=>{e.addEventListener("click",()=>{const n=e.nextElementSibling;if(n){const o=n.classList.toggle("expanded");e.querySelector(".facet-arrow")?.classList.toggle("rotated",o)}})}),He()}function He(){document.querySelectorAll(".facet-value").forEach(e=>{const n=e.getAttribute("data-count"),o=F();if(n&&o){const i=parseInt(n)/o*100,s=e.querySelector(".facet-count-bar");s&&(s.style.width=`${Math.max(i,5)}%`)}})}function F(){const t=document.querySelector(".results-count");if(t){const n=(t.textContent||"").match(/\d+/);return n?parseInt(n[0]):0}return 0}function Oe(){const t=new URLSearchParams(window.location.search);return parseInt(t.get("page")||"1")}function Fe(){const t={};return new URLSearchParams(window.location.search).forEach((n,o)=>{o!=="q"&&o!=="page"&&(t[o]=n)}),t}function Ve(){const t=u.createElement("div",{className:"search-error-message"},['<i class="fas fa-exclamation-triangle"></i>',"<h3>Search Temporarily Unavailable</h3>","<p>Please try refreshing the page or come back later.</p>",'<button class="btn-primary" onclick="window.location.reload()">Refresh Page</button>']),e=document.getElementById("search-results");e&&(e.innerHTML="",e.appendChild(t))}function Ue(){console.log("Initializing categories...");const t=document.getElementById("priceRange"),e=document.getElementById("priceDisplay"),n=document.getElementById("inStock");if(t&&e){const o=u.debounce(i=>{const s=u.updateQueryStringParameter(window.location.href,"max_price",i);window.location.href=s},800);t.addEventListener("input",()=>{const i=t.value;e.textContent=`${i} KES`,o(i)})}n&&n.addEventListener("change",()=>{const o=n.checked?u.updateQueryStringParameter(window.location.href,"in_stock","true"):u.removeQueryStringParameter(window.location.href,"in_stock");window.location.href=o}),ze()}function ze(){const t=document.getElementById("category-sort");t&&t.addEventListener("change",u.debounce(()=>{V("sort",t.value)},300))}function je(t){t.querySelectorAll("[data-filter-count]").forEach(n=>{const o=n.getAttribute("data-filter-name"),i=n.getAttribute("data-filter-count"),s=document.querySelector(`[data-filter-name="${o}"]`);if(s){s.setAttribute("data-filter-count",i);const r=s.querySelector(".filter-count");r&&(r.textContent=i)}})}function V(t,e){const n=new URL(window.location.href);e?n.searchParams.set(t,e):n.searchParams.delete(t),document.body.classList.contains("ajax-category")?Qe(n):window.history.replaceState({},"",n.toString())}function Qe(t){const e=document.getElementById("category-products"),n=document.getElementById("category-loading");e&&n&&(e.classList.add("loading"),n.classList.remove("hidden"),t.searchParams.set("ajax","true"),fetch(t.toString()).then(o=>o.text()).then(o=>{const s=new DOMParser().parseFromString(o,"text/html"),r=s.getElementById("category-products");r&&(e.innerHTML=r.innerHTML,_e(),je(s),Ge(s))}).catch(o=>{console.error("Failed to update category products:",o),Ze()}).finally(()=>{e.classList.remove("loading"),n.classList.add("hidden")}))}function _e(){document.querySelectorAll(".category-product-card").forEach(e=>{e.addEventListener("mouseenter",()=>{e.classList.add("hover"),Xe(e)}),e.addEventListener("mouseleave",()=>{e.classList.remove("hover")}),Ke(e),We(e)}),Ye()}function Xe(t){const e=t.getAttribute("data-hover-image");if(e&&!t.classList.contains("image-preloaded")){const n=new Image;n.src=e,n.onload=()=>{t.classList.add("image-preloaded")}}}function We(t){const e=t.querySelectorAll("img[data-src]"),n=new IntersectionObserver(o=>{o.forEach(i=>{if(i.isIntersecting){const s=i.target;s.src=s.getAttribute("data-src"),s.removeAttribute("data-src"),n.unobserve(s),s.addEventListener("load",()=>{s.classList.add("loaded")})}})});e.forEach(o=>n.observe(o))}function Ke(t){const e=t.querySelector(".product-quick-actions");if(e){const n=e.querySelector(".quick-add-btn");n?.addEventListener("click",i=>{i.preventDefault();const s=t.getAttribute("data-product-id");s&&(R.quickAdd(parseInt(s),1),n.innerHTML='<i class="fas fa-check"></i>',setTimeout(()=>{n.innerHTML='<i class="fas fa-cart-plus"></i>'},1e3))}),e.querySelector(".quick-view-btn")?.addEventListener("click",i=>{i.preventDefault();const s=t.getAttribute("data-product-id");s&&H(()=>Promise.resolve().then(()=>M),void 0).then(()=>{console.log("Quick view for product:",s)})})}}function Ye(){const t=document.getElementById("category-sort");t&&t.addEventListener("change",u.debounce(()=>{V("sort",t.value)},300)),Je()}function Je(){const t=document.querySelectorAll(".category-view-mode-btn"),e=document.querySelector(".category-products-grid");t.forEach(i=>{i.addEventListener("click",()=>{const s=i.getAttribute("data-mode");t.forEach(r=>r.classList.remove("active")),i.classList.add("active"),e&&(e.className=`category-products-grid ${s}-view`),u.setStorage("category-view-mode",s)})});const n=u.getStorage("category-view-mode")||"grid",o=document.querySelector(`[data-mode="${n}"]`);o&&o.click()}function Ge(t){const e=t.querySelector(".product-count"),n=document.querySelector(".product-count");e&&n&&(n.textContent=e.textContent,u.animateElement(n,"pulse",300))}function Ze(){const t=u.createElement("div",{className:"category-error-message"},['<i class="fas fa-exclamation-triangle"></i>',"<h3>Category Unavailable</h3>","<p>There was a problem loading this category. Please try again.</p>",'<button class="btn-primary" onclick="window.location.reload()">Retry</button>']),e=document.getElementById("category-content");e&&(e.innerHTML="",e.appendChild(t))}console.log("üü¢ STORE main.ts loaded");let P=!1;function B(){if(P){console.warn("‚ö†Ô∏è  Store already initialized, skipping...");return}const t=document.body.dataset.page;console.log(`üõí Store main script loaded. Page: ${t}`),t==="product-detail"?(console.log("üîç Detected product detail page"),L()):t==="product-list"?(console.log("üì¶ Detected product list page"),S()):t==="search"?(console.log("üîé Detected search page"),ve()):t==="categories"&&(console.log("üìÇ Detected categories page"),Ue()),P=!0,document.body.addEventListener("htmx:afterSwap",e=>{const n=e.detail?.target;n&&t==="product-list"&&n.id==="resultsRoot"&&(console.log("‚Üª HTMX afterSwap on resultsRoot ‚Äì re-init product list logic"),S())})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",B):B();
