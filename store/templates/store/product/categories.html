{% extends 'store/base.html' %}
{% load humanize static query_transform %}

{% block body_class %}categories-page{% endblock %}
{% block page_name %}categories{% endblock %}

{% block content %}
<div class="categories-container">
    <div class="category-nav">
        <div class="category-nav-list">
            <a href="{% url 'store:product_list' %}" class="category-tag {% if not category %}active{% endif %}">All Products</a>
            {% for cat in categories %}
            <a href="{{ cat.get_absolute_url }}" class="category-tag {% if cat == category %}active{% endif %}">{{ cat.name }}</a>
            {% endfor %}
        </div>
    </div>

    <div class="page-header">
        <div>
            <h1 class="page-title">{% if category %}{{ category.name }}{% else %}Premium Gaming Products{% endif %}</h1>
            {% if category %}<p class="page-description">{{ category.description }}</p>{% endif %}
        </div>
        <div class="product-count">{{ products.paginator.count }} Products</div>
    </div>

    <div class="categories-layout">
        <aside class="filter-sidebar" aria-label="Filters">
            <div class="filter-card">
                <div class="filter-header">
                    <h2 class="filter-title"><i class="fas fa-filter" aria-hidden="true"></i> Filters</h2>
                    <a href="?{% query_transform sort=request.GET.sort max_price=None in_stock=None brand=None supplier=None %}" class="reset-link">Reset All</a>
                </div>

                <div class="filter-section">
                    <h3 class="section-title"><i class="fas fa-sort section-icon" aria-hidden="true"></i>Sort By</h3>
                    <div class="sort-options">
                        {% for sort_key, sort_name in sort_options.items %}
                        <a href="?{% query_transform sort=sort_key %}" class="sort-option {% if request.GET.sort == sort_key %}active{% endif %}">
                            <span>{{ sort_name }}</span>
                            {% if request.GET.sort == sort_key %}
                            <i class="fas fa-check" aria-hidden="true"></i>
                            {% else %}
                            <i class="fas fa-chevron-right" aria-hidden="true"></i>
                            {% endif %}
                        </a>
                        {% endfor %}
                    </div>
                </div>

                <div class="filter-section">
                    <h3 class="section-title"><i class="fas fa-tag section-icon" aria-hidden="true"></i>Price Range</h3>
                    <div class="price-filter">
                        <input type="range" class="price-slider" min="0" max="100000" value="{% if request.GET.max_price %}{{ request.GET.max_price }}{% else %}1000{% endif %}" id="priceRange">
                        <div class="price-display">
                            <span>0 KES</span>
                            <span id="priceDisplay">{% if request.GET.max_price %}{{ request.GET.max_price }}{% else %}1000{% endif %} KES</span>
                        </div>
                    </div>
                </div>

                <div class="filter-section">
                    <h3 class="section-title"><i class="fas fa-box section-icon" aria-hidden="true"></i>Availability</h3>
                    <div class="stock-filter">
                        <input type="checkbox" id="inStock" class="stock-checkbox" {% if request.GET.in_stock %}checked{% endif %}>
                        <label for="inStock" class="stock-label">In Stock Only</label>
                    </div>
                </div>
            </div>
        </aside>

        <div class="products-grid" id="resultsRoot">
            {% include 'store/product/_results_grid.html' %}
        </div>
    </div>
</div>

<script src="{% static 'store/js/search.js' %}"></script>
{% endblock %}
